<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Bot Terminal: JavaScript host API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bot Terminal
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">JavaScript host API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#js_api__general">General JavaScript host API</a><ul><li class="level2"><a href="#js_api__object_creation">Object creation</a></li>
<li class="level2"><a href="#js_api__bytearr_read">Read-only byte array</a></li>
<li class="level2"><a href="#js_api__bytearr_read_write">Read-write byte array</a></li>
<li class="level2"><a href="#js_api__io">IO</a></li>
<li class="level2"><a href="#js_api__console_output">Console output</a></li>
</ul>
</li>
<li class="level1"><a href="#js_api__handler">Handlers API</a><ul><li class="level2"><a href="#js_api__handler__input_msg">Input message argument</a></li>
<li class="level2"><a href="#js_api__handler__handling_result">Handling result</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Concise description of JavaScript host API.</p>
<p>By <em>host API</em>, I mean API specific to Bot Terminal (which is a JavaScript host in this context). And by <em>host object</em>, I mean some object that is specific to Bot Terminal.</p>
<h1><a class="anchor" id="js_api__general"></a>
General JavaScript host API</h1>
<h2><a class="anchor" id="js_api__object_creation"></a>
Object creation</h2>
<p>To provide scripts with a way to create host objects, the global symbol <code>factory</code> is exposed. It currently provides the following methods:</p>
<ul>
<li><code>createByteArr()</code> : creates new read-write byte array (see <a class="el" href="js_api.html#js_api__bytearr_read_write">Read-write byte array</a>)</li>
</ul>
<p>Usage example:</p>
<div class="fragment"><div class="line">var outputArr = factory.createByteArr();</div>
<div class="line">outputArr.putU08(0, 0xc7);</div>
</div><!-- fragment --><p>For C++ class that represents the <code>factory</code> functionality, see <code><a class="el" href="classBTCore_1_1ScriptFactory.html" title="Factory that is used in JavaScript scripts to create various objects, namely BTCore::ByteArrReadWrite...">BTCore::ScriptFactory</a></code>. Only methods marked with <code>Q_INVOKABLE</code> macro can be called from scripts.</p>
<h2><a class="anchor" id="js_api__bytearr_read"></a>
Read-only byte array</h2>
<p>Input data is passed to user's JavaScript handlers as read-only byte arrays. Each such array provides the following API:</p>
<ul>
<li><code>getLength()</code> : returns the length of the array</li>
<li><code>getU08(index)</code> : returns unsigned 8-bit value from byte array by index. If index is too large, <code>0xff</code> is returned.</li>
<li><code>getU16(index)</code> : returns unsigned 16-bit value from byte array by index. If index is too large, <code>0xffff</code> is returned.</li>
<li><code>getU32(index)</code> : returns unsigned 32-bit value from byte array by index. If index is too large, <code>0xffffffff</code> is returned.</li>
<li><code>getS08(index)</code> : returns signed 8-bit value from byte array by index. If index is too large, <code>0xff</code> is returned.</li>
<li><code>getS16(index)</code> : returns signed 16-bit value from byte array by index. If index is too large, <code>0xffff</code> is returned.</li>
<li><code>getS32(index)</code> : returns signed 32-bit value from byte array by index. If index is too large, <code>0xffffffff</code> is returned.</li>
</ul>
<p>Such an array can't be created from script.</p>
<p>Usage example:</p>
<div class="fragment"><div class="line"><span class="comment">//-- assume we have read-only byte array inputArr</span></div>
<div class="line"><span class="keywordflow">if</span> (inputArr.getU08(0) === 0x07){</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>For C++ class that represents this functionality, see <code><a class="el" href="classBTCore_1_1ByteArrRead.html" title="Class that provides read-only byte array functionality for scripts. ">BTCore::ByteArrRead</a></code>. Only methods marked with <code>Q_INVOKABLE</code> macro can be called from scripts.</p>
<h2><a class="anchor" id="js_api__bytearr_read_write"></a>
Read-write byte array</h2>
<p>Read-write byte arrays inherit all methods from <a class="el" href="js_api.html#js_api__bytearr_read">read-only byte arrays</a>, and additionally provide the following API:</p>
<ul>
<li><code>setFillByte(fill_byte)</code> : set the byte value with which byte array should be filled when it is being extended by some <code>put...</code> methods.</li>
<li><code>putU08(index, val, end = LITTLE_END)</code> : put unsigned 8-bit value to byte array at specified index. If index is too large, array will be extended as necessary, and newly allocated data will be filled with <code>fill_byte</code> (see <code>setFillByte()</code> above)</li>
<li><code>putU16(index, val, end = LITTLE_END)</code> : put unsigned 16-bit value to byte array at specified index. If index is too large, array will be extended as necessary, and newly allocated data will be filled with <code>fill_byte</code> (see <code>setFillByte()</code> above)</li>
<li><code>putU32(index, val, end = LITTLE_END)</code> : put unsigned 32-bit value to byte array at specified index. If index is too large, array will be extended as necessary, and newly allocated data will be filled with <code>fill_byte</code> (see <code>setFillByte()</code> above)</li>
<li><code>putS08(index, val, end = LITTLE_END)</code> : put signed 8-bit value to byte array at specified index. If index is too large, array will be extended as necessary, and newly allocated data will be filled with <code>fill_byte</code> (see <code>setFillByte()</code> above)</li>
<li><code>putS16(index, val, end = LITTLE_END)</code> : put signed 16-bit value to byte array at specified index. If index is too large, array will be extended as necessary, and newly allocated data will be filled with <code>fill_byte</code> (see <code>setFillByte()</code> above)</li>
<li><code>putS32(index, val, end = LITTLE_END)</code> : put signed 32-bit value to byte array at specified index. If index is too large, array will be extended as necessary, and newly allocated data will be filled with <code>fill_byte</code> (see <code>setFillByte()</code> above)</li>
</ul>
<p>Note that all the <code>put...</code> and <code>set...</code> methods above return the object itself, so it's possible to chain these calls, like this:</p>
<div class="fragment"><div class="line"><span class="comment">//-- create empty read-write byte array</span></div>
<div class="line">outputArr = factory.createByteArr();</div>
<div class="line"></div>
<div class="line"><span class="comment">//-- put some data inside (notice the chaining syntax)</span></div>
<div class="line">outputArr</div>
<div class="line">    .setFillByte(0x55)</div>
<div class="line">    .putU08(0, 0xc7)</div>
<div class="line">    .putU16(5, 0x1234)</div>
<div class="line">    .putU16(7, 0x1234, BIG_END)</div>
<div class="line">    ;</div>
<div class="line"></div>
<div class="line"><span class="comment">//-- now, outputArr keeps the following data:</span></div>
<div class="line"><span class="comment">//   [ 0xc7, 0x55, 0x55, 0x55, 0x55, 0x34, 0x12, 0x12, 0x34 ]</span></div>
</div><!-- fragment --><p>You might have noticed the <code>LITTLE_END</code> and <code>BIG_END</code> global symbols. Obviously, they specify whether multi-byte value should be written in little-endian or big-endian format. By default, little-endian is used.</p>
<p>Such an array be created from script by calling <code>factory.createByteArr()</code> (see <a class="el" href="js_api.html#js_api__object_creation">Object creation</a>)</p>
<p>For C++ class that represents this functionality, see <code><a class="el" href="classBTCore_1_1ByteArrReadWrite.html" title="Class that provides read-write byte array functionality for scripts. ">BTCore::ByteArrReadWrite</a></code>. Only methods marked with <code>Q_INVOKABLE</code> macro can be called from scripts.</p>
<h2><a class="anchor" id="js_api__io"></a>
IO</h2>
<p>For input-output, a global symbol <code>io</code> is exposed.</p>
<ul>
<li><code>writeEncoded(byteArr, descr = "")</code> : encode given byte array, and send via serial port. If description is provided, is is shown in the application log together with the output message.</li>
<li><code>writePlain(byteArr, descr = "")</code> : The same as <code>writeEncoded()</code>, but don't encode message, and send it as it is instead.</li>
</ul>
<p>Usage example:</p>
<div class="fragment"><div class="line"><span class="comment">//-- build some byte array</span></div>
<div class="line">outputArr = factory.createByteArr();</div>
<div class="line">outputArr</div>
<div class="line">    .putU08(0, 0xc7)</div>
<div class="line">    .putU16(2, 0x1234)</div>
<div class="line">    ;</div>
<div class="line"></div>
<div class="line"><span class="comment">//-- encode and send response via serial port</span></div>
<div class="line">io.writeEncoded(outputArr);</div>
</div><!-- fragment --><p>For C++ class that represents this functionality, see <code><a class="el" href="classBTCore_1_1ScriptIO.html" title="Class that provides io methods for scripts: ">BTCore::ScriptIO</a></code>. Only methods marked with <code>Q_INVOKABLE</code> macro can be called from scripts.</p>
<h2><a class="anchor" id="js_api__console_output"></a>
Console output</h2>
<p>For console output, a global symbol <code>console</code> is exposed. For now, it only has one method, and it is very simple:</p>
<ul>
<li><code>log(value)</code> : echo some arbitrary value to the application's log. This implementation is much simpler than you probably have already worked with in browsers or Node.js: it accepts just a single value, calls <code>toString()</code> on it and prints the result.</li>
</ul>
<p>Usage example:</p>
<div class="fragment"><div class="line">console.log(<span class="stringliteral">&quot;hello world!&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//-- assume we have inputArr</span></div>
<div class="line">console.log(inputArr.getU08(0));</div>
</div><!-- fragment --><p>For C++ class that represents this functionality, see <code><a class="el" href="classBTCore_1_1ScriptConsole.html" title="Class that provides console methods for scripts: ">BTCore::ScriptConsole</a></code>. Only methods marked with <code>Q_INVOKABLE</code> macro can be called from scripts.</p>
<h1><a class="anchor" id="js_api__handler"></a>
Handlers API</h1>
<p>When some message is received, Bot Terminal executes the sequence of the handlers. Each handler, if it wants to, can perform some actions in response, and probably stop handlers sequence execution.</p>
<p>A handler should be written in a well-defined manner:</p>
<ul>
<li>The handler expression should evaluate to a function value;</li>
<li>This function should take an input message argument (see details below);</li>
<li>This function should return an object that designates handling result (see details below).</li>
</ul>
<h2><a class="anchor" id="js_api__handler__input_msg"></a>
Input message argument</h2>
<p>When handler's function is called, it is given the input message argument. It looks as follows:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">   byteArr: &lt;read-only byte array with received request data&gt;</div>
<div class="line">}</div>
</div><!-- fragment --><p>As you see, currently there is just a single property <code>byteArr</code>, which contains a reference to the request data byte array. I have some plans to add other data to the input message object: at least, codec-specific data about decoded message, such as target address (if any), source address (if any), etc.</p>
<p>So, the handler code may look as follows:</p>
<div class="fragment"><div class="line">(<span class="keyword">function</span>(inputMsg){</div>
<div class="line">    <span class="comment">//-- store byte array in separate variable, for easier access</span></div>
<div class="line">    var inputArr = inputMsg.byteArr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//-- ... perform some actions and return handling result</span></div>
<div class="line">    <span class="comment">//       (see below)</span></div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="js_api__handler__handling_result"></a>
Handling result</h2>
<p>The handler function is expected to return an object which contains the following properties:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">   handled: &lt;<span class="keywordtype">bool</span> value indicating whether the request was successfully handled&gt;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The only property <code>handled</code> indicates whether the handler has succeed in handling the request. If it is <code>false</code>, the next handler (if any) gets executed. If, hovewer, it is set to <code>true</code>, then handlers sequence execution stops.</p>
<p>The handler is not obliged to actually do something (say, send some data via <code>io</code>). It is pretty much legal for the handler to do nothing and just return <code>{handled: true}</code>, so that the request message actually gets ignored by Bot Terminal.</p>
<p>A complete example of handler may look as follows:</p>
<div class="fragment"><div class="line">(<span class="keyword">function</span>(inputMsg){</div>
<div class="line">    <span class="comment">//-- store byte array in separate variable, for easier access</span></div>
<div class="line">    var inputArr = inputMsg.byteArr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//-- for convenience, declare local variable &quot;handled&quot;</span></div>
<div class="line">    <span class="comment">//   which indicates whether the request was handled</span></div>
<div class="line">    var handled = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//-- if we need to generate response, this variable will be set</span></div>
<div class="line">    <span class="comment">//   to read-write bytearray later</span></div>
<div class="line">    var outputArr = null;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//-- check if we should handle this request</span></div>
<div class="line">    <span class="comment">//   (here, we check the value of the first byte)</span></div>
<div class="line">    <span class="keywordflow">if</span> (inputArr.getU08(0) === 0x07){</div>
<div class="line">        <span class="comment">//-- yes, so, build the response</span></div>
<div class="line">        outputArr = factory.createByteArr();</div>
<div class="line">        outputArr</div>
<div class="line">            .putU08(0, 0xc7)</div>
<div class="line">            .putU16(2, 0x1234)</div>
<div class="line">            ;</div>
<div class="line"></div>
<div class="line">        <span class="comment">//-- indicate that we&#39;ve handled the request</span></div>
<div class="line">        <span class="comment">//   (this value will be returned later)</span></div>
<div class="line">        handled = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">//-- encode and send response via serial port</span></div>
<div class="line">        io.writeEncoded(outputArr);</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="comment">//-- finally, return the handling result object</span></div>
<div class="line">    <span class="keywordflow">return</span> {</div>
<div class="line">        handled: handled</div>
<div class="line">    };</div>
<div class="line">})</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 26 2015 20:34:22 for Bot Terminal by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
