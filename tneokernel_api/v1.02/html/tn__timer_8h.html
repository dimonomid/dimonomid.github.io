<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>TNeoKernel: core/tn_timer.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-7163754-5', 'auto');
  ga('send', 'pageview');
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TNeoKernel
   &#160;<span id="projectnumber">v1.02</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4270bfced15e0e73154b13468c7c9ad9.html">core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tn_timer.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Timer is a kernel object that is used to ask the kernel to call some user-provided function at a particular time in the future, based on the <em><a class="el" href="quick_guide.html#time_ticks">system timer</a></em> tick. </p>
<p>If you need to repeatedly wake up particular task, you can create semaphore which you should <a class="el" href="tn__sem_8h.html#a6bf88a78f4f8b2799f72ee671b52ed97">wait for</a> in the task, and <a class="el" href="tn__sem_8h.html#a215fd97b86fc63192106bb30b0574d14">signal</a> in the timer callback (remember that you should use <code><a class="el" href="tn__sem_8h.html#a215fd97b86fc63192106bb30b0574d14" title="The same as tn_sem_signal() but for using in the ISR. ">tn_sem_isignal()</a></code> in this callback, since it is called from an ISR).</p>
<p>If you need to perform rather fast action (such as toggle some pin, or the like), consider doing that right in the timer callback, in order to avoid context switch overhead.</p>
<p>The timer callback approach provides ultimate flexibility.</p>
<p>In the spirit of TNeoKernel, timers are as lightweight as possible. That's why there is only one type of timer: the single-shot timer. If you need your timer to fire repeatedly, you can easily restart it from the timer function by the <code><a class="el" href="tn__timer_8h.html#ad2e783b412081d6d266a15e0ce733ab3" title="Start or restart the timer: that is, schedule the timer&#39;s function (given to tn_timer_create()) to be...">tn_timer_start()</a></code>, so it's not a problem.</p>
<p>When timer fires, the user-provided function is called. Be aware of the following:</p>
<ul>
<li>Function is called from an ISR context (namely, from <em><a class="el" href="quick_guide.html#time_ticks">system timer</a></em> ISR, by the <code><a class="el" href="tn__sys_8h.html#a944d96c7a5d442d271115b6cb22a085b" title="Process system tick; should be called periodically, typically from some kind of timer ISR...">tn_tick_int_processing()</a></code>);</li>
<li>Function is called with global interrupts disabled.</li>
</ul>
<p>Consequently:</p>
<ul>
<li>It's legal to call interrupt services from this function;</li>
<li>You should make sure that your interrupt stack is enough for this function;</li>
<li>The function should be as fast as possible;</li>
<li>The function should not enable interrupts unconditionally. Consider using <code><a class="el" href="tn__arch_8h.html#a010a50388c4cdca7cdda8b82b1c17563" title="Disable interrupts and return previous value of status register, atomically. ">tn_arch_sr_save_int_dis()</a></code> and <code><a class="el" href="tn__arch_8h.html#a4662406a6972e7f4d99e8d8dd90218e0" title="Restore previously saved status register. ">tn_arch_sr_restore()</a></code> if you need.</li>
</ul>
<p>See <code><a class="el" href="tn__timer_8h.html#a98be38210cd5a636dc4170e087ea0e67" title="Prototype of the function that should be called by timer. ">TN_TimerFunc</a></code> for the prototype of the function that could be scheduled.</p>
<h1><a class="anchor" id="timers_implementation"></a>
Implementation of timers</h1>
<p>Although you don't have to understand the implementation of timers to use them, it is probably worth knowing, particularly because the kernel have an option <code><a class="el" href="tn__cfg__default_8h.html#afef2a6ec1baa81edaa979024af0c924a" title="Number of &quot;tick&quot; lists of timers, must be a power or two; minimum value: 2; typical values: 4...">TN_TICK_LISTS_CNT</a></code> to customize the balance between performance of <code><a class="el" href="tn__sys_8h.html#a944d96c7a5d442d271115b6cb22a085b" title="Process system tick; should be called periodically, typically from some kind of timer ISR...">tn_tick_int_processing()</a></code> and memory occupied by timers.</p>
<p>The easiest implementation of timers could be something like this: we have just a single list with all active timers, and at every system tick we should walk through all the timers in this list, and do the following with each timer:</p>
<ul>
<li>Decrement timeout by 1</li>
<li>If new timeout is 0, then remove that timer from the list (i.e. make timer inactive), and fire the appropriate timer function.</li>
</ul>
<p>This approach has drawbacks:</p>
<ul>
<li>We can't manage timers from the function called by timer. If we do so (say, if we start new timer), then the timer list gets modified. But we are currently iterating through this list, so, it's quite easy to mix things up.</li>
<li>It is inefficient on rather large amount of timers and/or with large timeouts: we should iterate through all of them each system tick.</li>
</ul>
<p>The latter is probably not so critical in the embedded world since large amount of timers is unlikely there; whereas the former is actually notable.</p>
<p>So, different approach was applied. The main idea is taken from the mainline Linux kernel source, but the implementation was simplified much because (1) embedded systems have much less resources, and (2) the kernel doesn't need to scale as well as Linux does. You can read about Linux timers implementation in the book "Linux Device Drivers", 3rd edition:</p>
<ul>
<li>Time, Delays, and Deferred Work<ul>
<li>Kernel Timers<ul>
<li>The Implementation of Kernel Timers</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This book is freely available at <a href="http://lwn.net/Kernel/LDD3/">http://lwn.net/Kernel/LDD3/</a> .</p>
<p>So, TNeoKernel's implementation:</p>
<p>We have configurable value <code>N</code> that is a power of two, typical values are <code>4</code>, <code>8</code> or <code>16</code>.</p>
<p>If the timer expires in the next <code>1</code> to <code>(N - 1)</code> system ticks, it is added to one of the <code>N</code> lists (the so-called "tick" lists) devoted to short-range timers using the least significant bits of the <code>timeout</code> value. If it expires farther in the future, it is added to the "generic" list.</p>
<p>Each <code>N</code>-th system tick, all the timers from "generic" list are walked through, and the following is performed with each timer:</p>
<ul>
<li><code>timeout</code> value decremented by <code>N</code></li>
<li>if resulting <code>timeout</code> is less than <code>N</code>, timer is moved to the appropriate "tick" list.</li>
</ul>
<p>At <em>every</em> system tick, all the timers from current "tick" list are fired unconditionally. This is an efficient and nice solution.</p>
<p>The attentive reader may want to ask why do we use <code>(N - 1)</code> "tick" lists if we actually have <code>N</code> lists. That's because, again, we want to be able to modify timers from the timer function. If we use <code>N</code> lists, and user wants to add new timer with <code>timeout</code> equal to <code>N</code>, then new timer will be added to the same list which is iterated through at the moment, and things will be mixed up.</p>
<p>If we use <code>(N - 1)</code> lists, we are guaranteed that new timers can't be added to the current "tick" list while we are iterating through it. (although timer can be deleted from that list, but it's ok)</p>
<p>The <code>N</code> in the TNeoKernel is configured by the compile-time option <code><a class="el" href="tn__cfg__default_8h.html#afef2a6ec1baa81edaa979024af0c924a" title="Number of &quot;tick&quot; lists of timers, must be a power or two; minimum value: 2; typical values: 4...">TN_TICK_LISTS_CNT</a></code>. </p>

<p>Definition in file <a class="el" href="tn__timer_8h_source.html">tn_timer.h</a>.</p>
</div>
<p><a href="tn__timer_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTN__Timer.html">TN_Timer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timer.  <a href="structTN__Timer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a98be38210cd5a636dc4170e087ea0e67"><td class="memItemLeft" align="right" valign="top">typedef void(&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__timer_8h.html#a98be38210cd5a636dc4170e087ea0e67">TN_TimerFunc</a> )(struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *timer, void *p_user_data)</td></tr>
<tr class="memdesc:a98be38210cd5a636dc4170e087ea0e67"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prototype of the function that should be called by timer.  <a href="#a98be38210cd5a636dc4170e087ea0e67">More...</a><br /></td></tr>
<tr class="separator:a98be38210cd5a636dc4170e087ea0e67"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a13fe1c64d32f7e554ac48d4331e7f5a2"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__timer_8h.html#a13fe1c64d32f7e554ac48d4331e7f5a2">tn_timer_create</a> (struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *timer, <a class="el" href="tn__timer_8h.html#a98be38210cd5a636dc4170e087ea0e67">TN_TimerFunc</a> *func, void *p_user_data)</td></tr>
<tr class="memdesc:a13fe1c64d32f7e554ac48d4331e7f5a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct the timer.  <a href="#a13fe1c64d32f7e554ac48d4331e7f5a2">More...</a><br /></td></tr>
<tr class="separator:a13fe1c64d32f7e554ac48d4331e7f5a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af97725f0e7e3a92864846aee64e7a55f"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__timer_8h.html#af97725f0e7e3a92864846aee64e7a55f">tn_timer_delete</a> (struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *timer)</td></tr>
<tr class="memdesc:af97725f0e7e3a92864846aee64e7a55f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destruct the timer.  <a href="#af97725f0e7e3a92864846aee64e7a55f">More...</a><br /></td></tr>
<tr class="separator:af97725f0e7e3a92864846aee64e7a55f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2e783b412081d6d266a15e0ce733ab3"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__timer_8h.html#ad2e783b412081d6d266a15e0ce733ab3">tn_timer_start</a> (struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *timer, <a class="el" href="tn__common_8h.html#a34c07c1fa20ae71d17817d28a41957fe">TN_Timeout</a> timeout)</td></tr>
<tr class="memdesc:ad2e783b412081d6d266a15e0ce733ab3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start or restart the timer: that is, schedule the timer's function (given to <code><a class="el" href="tn__timer_8h.html#a13fe1c64d32f7e554ac48d4331e7f5a2" title="Construct the timer. ">tn_timer_create()</a></code>) to be called later by the kernel.  <a href="#ad2e783b412081d6d266a15e0ce733ab3">More...</a><br /></td></tr>
<tr class="separator:ad2e783b412081d6d266a15e0ce733ab3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adda7385799b66fd32a1d00927fcabcf9"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__timer_8h.html#adda7385799b66fd32a1d00927fcabcf9">tn_timer_cancel</a> (struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *timer)</td></tr>
<tr class="memdesc:adda7385799b66fd32a1d00927fcabcf9"><td class="mdescLeft">&#160;</td><td class="mdescRight">If timer is active, cancel it.  <a href="#adda7385799b66fd32a1d00927fcabcf9">More...</a><br /></td></tr>
<tr class="separator:adda7385799b66fd32a1d00927fcabcf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa81f018e8a8e511f288781acbf79af72"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__timer_8h.html#aa81f018e8a8e511f288781acbf79af72">tn_timer_set_func</a> (struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *timer, <a class="el" href="tn__timer_8h.html#a98be38210cd5a636dc4170e087ea0e67">TN_TimerFunc</a> *func, void *p_user_data)</td></tr>
<tr class="memdesc:aa81f018e8a8e511f288781acbf79af72"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set user-provided function and pointer to user data for the timer.  <a href="#aa81f018e8a8e511f288781acbf79af72">More...</a><br /></td></tr>
<tr class="separator:aa81f018e8a8e511f288781acbf79af72"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59b7c3164cb5c5520e3b329e749fac20"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__timer_8h.html#a59b7c3164cb5c5520e3b329e749fac20">tn_timer_is_active</a> (struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *timer, <a class="el" href="tn__common_8h.html#ae4cc35dcc70810fa972cc8a5185a28fa">BOOL</a> *p_is_active)</td></tr>
<tr class="memdesc:a59b7c3164cb5c5520e3b329e749fac20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns whether given timer is active or inactive.  <a href="#a59b7c3164cb5c5520e3b329e749fac20">More...</a><br /></td></tr>
<tr class="separator:a59b7c3164cb5c5520e3b329e749fac20"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b4b96ba5e549c09f8b6364b04534f6d"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__timer_8h.html#a6b4b96ba5e549c09f8b6364b04534f6d">tn_timer_time_left</a> (struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *timer, <a class="el" href="tn__common_8h.html#a34c07c1fa20ae71d17817d28a41957fe">TN_Timeout</a> *p_time_left)</td></tr>
<tr class="memdesc:a6b4b96ba5e549c09f8b6364b04534f6d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns how many <em><a class="el" href="quick_guide.html#time_ticks">system timer</a></em> ticks (at most) is left for the timer to expire.  <a href="#a6b4b96ba5e549c09f8b6364b04534f6d">More...</a><br /></td></tr>
<tr class="separator:a6b4b96ba5e549c09f8b6364b04534f6d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="a98be38210cd5a636dc4170e087ea0e67"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void( TN_TimerFunc)(struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *timer, void *p_user_data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prototype of the function that should be called by timer. </p>
<p>When timer fires, the user-provided function is called. Be aware of the following:</p><ul>
<li>Function is called from ISR context (namely, from <em><a class="el" href="quick_guide.html#time_ticks">system timer</a></em> ISR, by the <code><a class="el" href="tn__sys_8h.html#a944d96c7a5d442d271115b6cb22a085b" title="Process system tick; should be called periodically, typically from some kind of timer ISR...">tn_tick_int_processing()</a></code>);</li>
<li>Function is called with global interrupts disabled.</li>
</ul>
<p>Consequently:</p>
<ul>
<li>It's legal to call interrupt services from this function;</li>
<li>The function should be as fast as possible.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>Timer that caused function to be called </td></tr>
    <tr><td class="paramname">p_user_data</td><td>The user-provided pointer given to <code><a class="el" href="tn__timer_8h.html#a13fe1c64d32f7e554ac48d4331e7f5a2" title="Construct the timer. ">tn_timer_create()</a></code>. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="tn__timer_8h_source.html#l00197">197</a> of file <a class="el" href="tn__timer_8h_source.html">tn_timer.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a13fe1c64d32f7e554ac48d4331e7f5a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_timer_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *&#160;</td>
          <td class="paramname"><em>timer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tn__timer_8h.html#a98be38210cd5a636dc4170e087ea0e67">TN_TimerFunc</a> *&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_user_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct the timer. </p>
<p><code>id_timer</code> field should not contain <code><a class="el" href="tn__common_8h.html#ae779dd1f6735f6e139fb70acd004d976a9695f4d7fb1f9f00a105db61fc43f153" title="id for timers ">TN_ID_TIMER</a></code>, otherwise, <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> is returned.</p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_int.png" alt="attr_call_int.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>Pointer to already allocated <code>struct <a class="el" href="structTN__Timer.html" title="Timer. ">TN_Timer</a></code> </td></tr>
    <tr><td class="paramname">func</td><td>Function to be called by timer, can't be <code>NULL</code>. See <code><a class="el" href="tn__timer_8h.html#a98be38210cd5a636dc4170e087ea0e67" title="Prototype of the function that should be called by timer. ">TN_TimerFunc()</a></code> </td></tr>
    <tr><td class="paramname">p_user_data</td><td>User data pointer that is given to user-provided <code>func</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if timer was successfully created;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> if wrong params were given. </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="af97725f0e7e3a92864846aee64e7a55f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_timer_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destruct the timer. </p>
<p>If the timer is active, it is cancelled first.</p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_int.png" alt="attr_call_int.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>timer to destruct</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if timer was successfully deleted;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a886368391507ae426bfdedc38284db9d" title="Wrong context error: returned if function is called from non-acceptable context. ">TN_RC_WCONTEXT</a></code> if called from wrong context;</li>
<li>If <code><a class="el" href="tn__cfg__default_8h.html#a1f197294df3276fec431930545acafd5" title="Enables additional param checking for most of the system functions. ">TN_CHECK_PARAM</a></code> is non-zero, additional return codes are available: <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> and <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a2a2df8fecee990d279889924926bf101" title="Returned when user tries to perform some operation on invalid object (mutex, semaphore, etc). ">TN_RC_INVALID_OBJ</a></code>. </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="ad2e783b412081d6d266a15e0ce733ab3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_timer_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *&#160;</td>
          <td class="paramname"><em>timer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tn__common_8h.html#a34c07c1fa20ae71d17817d28a41957fe">TN_Timeout</a>&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start or restart the timer: that is, schedule the timer's function (given to <code><a class="el" href="tn__timer_8h.html#a13fe1c64d32f7e554ac48d4331e7f5a2" title="Construct the timer. ">tn_timer_create()</a></code>) to be called later by the kernel. </p>
<p>See <code><a class="el" href="tn__timer_8h.html#a98be38210cd5a636dc4170e087ea0e67" title="Prototype of the function that should be called by timer. ">TN_TimerFunc()</a></code>.</p>
<p>It is legal to restart already active timer. In this case, the timer will be cancelled first.</p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_int.png" alt="attr_call_int.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>Timer to start </td></tr>
    <tr><td class="paramname">timeout</td><td>Number of system ticks after which timer should fire (i.e. function should be called). <b>Note</b> that <code>timeout</code> can't be <code><a class="el" href="tn__arch__example_8h.html#a16909a2a05bc2bc628109d843208a76b" title="Value for infinite waiting, usually matches UINT_MAX ">TN_WAIT_INFINITE</a></code> or <code>0</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if timer was successfully started;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a886368391507ae426bfdedc38284db9d" title="Wrong context error: returned if function is called from non-acceptable context. ">TN_RC_WCONTEXT</a></code> if called from wrong context;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> if wrong params were given: say, <code>timeout</code> is either <code><a class="el" href="tn__arch__example_8h.html#a16909a2a05bc2bc628109d843208a76b" title="Value for infinite waiting, usually matches UINT_MAX ">TN_WAIT_INFINITE</a></code> or <code>0</code>.</li>
<li>If <code><a class="el" href="tn__cfg__default_8h.html#a1f197294df3276fec431930545acafd5" title="Enables additional param checking for most of the system functions. ">TN_CHECK_PARAM</a></code> is non-zero, additional return code is available: <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a2a2df8fecee990d279889924926bf101" title="Returned when user tries to perform some operation on invalid object (mutex, semaphore, etc). ">TN_RC_INVALID_OBJ</a></code>. </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="adda7385799b66fd32a1d00927fcabcf9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_timer_cancel </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If timer is active, cancel it. </p>
<p>If timer is already inactive, nothing is changed.</p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_int.png" alt="attr_call_int.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>Timer to cancel</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if timer was successfully cancelled;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a886368391507ae426bfdedc38284db9d" title="Wrong context error: returned if function is called from non-acceptable context. ">TN_RC_WCONTEXT</a></code> if called from wrong context;</li>
<li>If <code><a class="el" href="tn__cfg__default_8h.html#a1f197294df3276fec431930545acafd5" title="Enables additional param checking for most of the system functions. ">TN_CHECK_PARAM</a></code> is non-zero, additional return codes are available: <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> and <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a2a2df8fecee990d279889924926bf101" title="Returned when user tries to perform some operation on invalid object (mutex, semaphore, etc). ">TN_RC_INVALID_OBJ</a></code>. </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="aa81f018e8a8e511f288781acbf79af72"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_timer_set_func </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *&#160;</td>
          <td class="paramname"><em>timer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tn__timer_8h.html#a98be38210cd5a636dc4170e087ea0e67">TN_TimerFunc</a> *&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_user_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set user-provided function and pointer to user data for the timer. </p>
<p>Can be called if timer is either active or inactive.</p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_int.png" alt="attr_call_int.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>Pointer to timer </td></tr>
    <tr><td class="paramname">func</td><td>Function to be called by timer, can't be <code>NULL</code>. See <code><a class="el" href="tn__timer_8h.html#a98be38210cd5a636dc4170e087ea0e67" title="Prototype of the function that should be called by timer. ">TN_TimerFunc()</a></code> </td></tr>
    <tr><td class="paramname">p_user_data</td><td>User data pointer that is given to user-provided <code>func</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if operation was successfull;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> if wrong params were given. </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="a59b7c3164cb5c5520e3b329e749fac20"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_timer_is_active </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *&#160;</td>
          <td class="paramname"><em>timer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tn__common_8h.html#ae4cc35dcc70810fa972cc8a5185a28fa">BOOL</a> *&#160;</td>
          <td class="paramname"><em>p_is_active</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns whether given timer is active or inactive. </p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_int.png" alt="attr_call_int.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>Pointer to timer </td></tr>
    <tr><td class="paramname">p_is_active</td><td>Pointer to <code><a class="el" href="tn__common_8h.html#ae4cc35dcc70810fa972cc8a5185a28fa" title="boolean type definition ">BOOL</a></code> variable in which resulting value should be stored</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if operation was successfull;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> if wrong params were given. </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="a6b4b96ba5e549c09f8b6364b04534f6d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_timer_time_left </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Timer.html">TN_Timer</a> *&#160;</td>
          <td class="paramname"><em>timer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tn__common_8h.html#a34c07c1fa20ae71d17817d28a41957fe">TN_Timeout</a> *&#160;</td>
          <td class="paramname"><em>p_time_left</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns how many <em><a class="el" href="quick_guide.html#time_ticks">system timer</a></em> ticks (at most) is left for the timer to expire. </p>
<p>If timer is inactive, 0 is returned.</p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_int.png" alt="attr_call_int.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>Pointer to timer </td></tr>
    <tr><td class="paramname">p_time_left</td><td>Pointer to <code><a class="el" href="tn__common_8h.html#a34c07c1fa20ae71d17817d28a41957fe" title="The value representing maximum number of system ticks to wait. ">TN_Timeout</a></code> variable in which resulting value should be stored</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if operation was successfull;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> if wrong params were given. </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Oct 14 2014 18:35:55 for TNeoKernel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
