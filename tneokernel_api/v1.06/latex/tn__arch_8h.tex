\hypertarget{tn__arch_8h}{\section{arch/tn\+\_\+arch.h File Reference}
\label{tn__arch_8h}\index{arch/tn\+\_\+arch.\+h@{arch/tn\+\_\+arch.\+h}}
}


\subsection{Detailed Description}
Architecture-\/dependent routines declaration. 



Definition in file \hyperlink{tn__arch_8h_source}{tn\+\_\+arch.\+h}.

\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{tn__arch_8h_a2b3f2294ac42a599662c573394b14c75}{tn\+\_\+arch\+\_\+int\+\_\+dis} (void)
\begin{DoxyCompactList}\small\item\em Unconditionally disable {\itshape system interrupts}. \end{DoxyCompactList}\item 
void \hyperlink{tn__arch_8h_a2997c6d98ac43cb90216fc4e8137bcfb}{tn\+\_\+arch\+\_\+int\+\_\+en} (void)
\begin{DoxyCompactList}\small\item\em Unconditionally enable interrupts. \end{DoxyCompactList}\item 
\hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word} \hyperlink{tn__arch_8h_a7078b776570ca67a51b89d2746bdb6f7}{tn\+\_\+arch\+\_\+sr\+\_\+save\+\_\+int\+\_\+dis} (void)
\begin{DoxyCompactList}\small\item\em Disable {\itshape system interrupts} and return previous value of status register, atomically. \end{DoxyCompactList}\item 
void \hyperlink{tn__arch_8h_aa755327bd8c4e4303c87c2b0cbed0f17}{tn\+\_\+arch\+\_\+sr\+\_\+restore} (\hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word} sr)
\begin{DoxyCompactList}\small\item\em Restore previously saved status register. \end{DoxyCompactList}\item 
\hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word} $\ast$ \hyperlink{tn__arch_8h_a8b4910c153815699beca8afdea88e4b5}{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get} (\hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word} $\ast$stack\+\_\+low\+\_\+address, int stack\+\_\+size)
\begin{DoxyCompactList}\small\item\em Should return top of the stack. \end{DoxyCompactList}\item 
\hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word} $\ast$ \hyperlink{tn__arch_8h_a649420966f186cfae459e459db91ed26}{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+bottom\+\_\+empty\+\_\+get} (\hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word} $\ast$stack\+\_\+top, int stack\+\_\+size)
\begin{DoxyCompactList}\small\item\em This function should return address of bottom empty element of stack, it is needed for software stack overflow control (see {\ttfamily \hyperlink{tn__cfg__default_8h_ac6a9bbac3b3b25d9b5bc8c21d2e09955}{T\+N\+\_\+\+S\+T\+A\+C\+K\+\_\+\+O\+V\+E\+R\+F\+L\+O\+W\+\_\+\+C\+H\+E\+C\+K}}). \end{DoxyCompactList}\item 
\hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word} $\ast$ \hyperlink{tn__arch_8h_a4fc5a94ec1abb9b24a14ea108d52defe}{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+init} (\hyperlink{tn__common_8h_a82f7de9034cbbb373c4dbcff45942343}{T\+N\+\_\+\+Task\+Body} $\ast$task\+\_\+func, \hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word} $\ast$stack\+\_\+top, int stack\+\_\+size, void $\ast$param)
\begin{DoxyCompactList}\small\item\em Should put initial C\+P\+U context to the provided stack pointer for new task and return current stack pointer. \end{DoxyCompactList}\item 
int \hyperlink{tn__arch_8h_a34ffbae8b6837f7f3014bca9991e2272}{\+\_\+tn\+\_\+arch\+\_\+inside\+\_\+isr} (void)
\begin{DoxyCompactList}\small\item\em Should return 1 if {\itshape system I\+S\+R} is currently running, 0 otherwise. \end{DoxyCompactList}\item 
int \hyperlink{tn__arch_8h_a024f41d79c823ecac5ed6b83c36f164e}{\+\_\+tn\+\_\+arch\+\_\+is\+\_\+int\+\_\+disabled} (void)
\begin{DoxyCompactList}\small\item\em Should return 1 if {\itshape system interrupts} are currently disabled, 0 otherwise. \end{DoxyCompactList}\item 
void \hyperlink{tn__arch_8h_a28871f82c82d549092930dd4842e2980}{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+pend} (void)
\begin{DoxyCompactList}\small\item\em Called whenever we need to switch context from one task to another. \end{DoxyCompactList}\item 
void \hyperlink{tn__arch_8h_afd5f43f42f5645de164ba6d13d3a4bcf}{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+now\+\_\+nosave} (void)
\begin{DoxyCompactList}\small\item\em Called whenever we need to switch context to new task, but don't save current context. \end{DoxyCompactList}\item 
void \hyperlink{tn__arch_8h_aa7c39f947f344a697bcbfe9db10de153}{\+\_\+tn\+\_\+arch\+\_\+sys\+\_\+start} (\hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word} $\ast$int\+\_\+stack, unsigned int int\+\_\+stack\+\_\+size)
\begin{DoxyCompactList}\small\item\em Performs first context switch to the first task ({\ttfamily \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run} is already set to needed task). \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{tn__arch_8h_a2b3f2294ac42a599662c573394b14c75}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!tn\+\_\+arch\+\_\+int\+\_\+dis@{tn\+\_\+arch\+\_\+int\+\_\+dis}}
\index{tn\+\_\+arch\+\_\+int\+\_\+dis@{tn\+\_\+arch\+\_\+int\+\_\+dis}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{tn\+\_\+arch\+\_\+int\+\_\+dis}]{\setlength{\rightskip}{0pt plus 5cm}void tn\+\_\+arch\+\_\+int\+\_\+dis (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_a2b3f2294ac42a599662c573394b14c75}


Unconditionally disable {\itshape system interrupts}. 

Refer to the section \hyperlink{interrupts_interrupt_types}{Interrupt types} for details on what is {\itshape system interrupt}. \hypertarget{tn__arch_8h_a2997c6d98ac43cb90216fc4e8137bcfb}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!tn\+\_\+arch\+\_\+int\+\_\+en@{tn\+\_\+arch\+\_\+int\+\_\+en}}
\index{tn\+\_\+arch\+\_\+int\+\_\+en@{tn\+\_\+arch\+\_\+int\+\_\+en}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{tn\+\_\+arch\+\_\+int\+\_\+en}]{\setlength{\rightskip}{0pt plus 5cm}void tn\+\_\+arch\+\_\+int\+\_\+en (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_a2997c6d98ac43cb90216fc4e8137bcfb}


Unconditionally enable interrupts. 

Refer to the section \hyperlink{interrupts_interrupt_types}{Interrupt types} for details on what is {\itshape system interrupt}. \hypertarget{tn__arch_8h_a7078b776570ca67a51b89d2746bdb6f7}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!tn\+\_\+arch\+\_\+sr\+\_\+save\+\_\+int\+\_\+dis@{tn\+\_\+arch\+\_\+sr\+\_\+save\+\_\+int\+\_\+dis}}
\index{tn\+\_\+arch\+\_\+sr\+\_\+save\+\_\+int\+\_\+dis@{tn\+\_\+arch\+\_\+sr\+\_\+save\+\_\+int\+\_\+dis}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{tn\+\_\+arch\+\_\+sr\+\_\+save\+\_\+int\+\_\+dis}]{\setlength{\rightskip}{0pt plus 5cm}{\bf T\+N\+\_\+\+U\+Word} tn\+\_\+arch\+\_\+sr\+\_\+save\+\_\+int\+\_\+dis (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_a7078b776570ca67a51b89d2746bdb6f7}


Disable {\itshape system interrupts} and return previous value of status register, atomically. 

Refer to the section \hyperlink{interrupts_interrupt_types}{Interrupt types} for details on what is {\itshape system interrupt}.

\begin{DoxySeeAlso}{See also}
{\ttfamily \hyperlink{tn__arch_8h_aa755327bd8c4e4303c87c2b0cbed0f17}{tn\+\_\+arch\+\_\+sr\+\_\+restore()}} 
\end{DoxySeeAlso}
\hypertarget{tn__arch_8h_aa755327bd8c4e4303c87c2b0cbed0f17}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!tn\+\_\+arch\+\_\+sr\+\_\+restore@{tn\+\_\+arch\+\_\+sr\+\_\+restore}}
\index{tn\+\_\+arch\+\_\+sr\+\_\+restore@{tn\+\_\+arch\+\_\+sr\+\_\+restore}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{tn\+\_\+arch\+\_\+sr\+\_\+restore}]{\setlength{\rightskip}{0pt plus 5cm}void tn\+\_\+arch\+\_\+sr\+\_\+restore (
\begin{DoxyParamCaption}
\item[{{\bf T\+N\+\_\+\+U\+Word}}]{sr}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_aa755327bd8c4e4303c87c2b0cbed0f17}


Restore previously saved status register. 


\begin{DoxyParams}{Parameters}
{\em sr} & status register value previously from {\ttfamily \hyperlink{tn__arch_8h_a7078b776570ca67a51b89d2746bdb6f7}{tn\+\_\+arch\+\_\+sr\+\_\+save\+\_\+int\+\_\+dis()}}\\
\hline
\end{DoxyParams}
\begin{DoxySeeAlso}{See also}
{\ttfamily \hyperlink{tn__arch_8h_a7078b776570ca67a51b89d2746bdb6f7}{tn\+\_\+arch\+\_\+sr\+\_\+save\+\_\+int\+\_\+dis()}} 
\end{DoxySeeAlso}
\hypertarget{tn__arch_8h_a8b4910c153815699beca8afdea88e4b5}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get@{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get}}
\index{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get@{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get}]{\setlength{\rightskip}{0pt plus 5cm}{\bf T\+N\+\_\+\+U\+Word}$\ast$ \+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get (
\begin{DoxyParamCaption}
\item[{{\bf T\+N\+\_\+\+U\+Word} $\ast$}]{stack\+\_\+low\+\_\+address, }
\item[{int}]{stack\+\_\+size}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_a8b4910c153815699beca8afdea88e4b5}


Should return top of the stack. 

A stack implementation is characterized by two attributes\+:


\begin{DoxyItemize}
\item Where the stack pointer points\+:
\begin{DoxyItemize}
\item {\itshape Full stack}\+: The stack pointer points to the last full location;
\item {\itshape Empty stack}\+: The stack pointer points to the first empty location.
\end{DoxyItemize}
\item How the stack grows\+:
\begin{DoxyItemize}
\item {\itshape Descending stack}\+: The stack grows downward (i.\+e., toward lower memory addresses);
\item {\itshape Ascending stack}\+: The stack grows upward (i.\+e., toward higher memory addresses).
\end{DoxyItemize}
\end{DoxyItemize}

So, depending on the stack implementation used in the particular architecture, the value returned from this function can be one of the following\+:


\begin{DoxyItemize}
\item {\ttfamily (stack\+\_\+low\+\_\+address -\/ 1)} ({\itshape Full ascending stack})
\item {\ttfamily (stack\+\_\+low\+\_\+address + stack\+\_\+size)} ({\itshape Full descending stack})
\item {\ttfamily (stack\+\_\+low\+\_\+address)} ({\itshape Empty ascending stack})
\item {\ttfamily (stack\+\_\+low\+\_\+address + stack\+\_\+size -\/ 1)} ({\itshape Empty descending stack})
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em stack\+\_\+low\+\_\+address} & Start address of the stack array. \\
\hline
{\em stack\+\_\+size} & Size of the stack in {\ttfamily \hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word}}-\/s, not in bytes. \\
\hline
\end{DoxyParams}
\hypertarget{tn__arch_8h_a649420966f186cfae459e459db91ed26}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+bottom\+\_\+empty\+\_\+get@{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+bottom\+\_\+empty\+\_\+get}}
\index{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+bottom\+\_\+empty\+\_\+get@{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+bottom\+\_\+empty\+\_\+get}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+bottom\+\_\+empty\+\_\+get}]{\setlength{\rightskip}{0pt plus 5cm}{\bf T\+N\+\_\+\+U\+Word}$\ast$ \+\_\+tn\+\_\+arch\+\_\+stack\+\_\+bottom\+\_\+empty\+\_\+get (
\begin{DoxyParamCaption}
\item[{{\bf T\+N\+\_\+\+U\+Word} $\ast$}]{stack\+\_\+top, }
\item[{int}]{stack\+\_\+size}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_a649420966f186cfae459e459db91ed26}


This function should return address of bottom empty element of stack, it is needed for software stack overflow control (see {\ttfamily \hyperlink{tn__cfg__default_8h_ac6a9bbac3b3b25d9b5bc8c21d2e09955}{T\+N\+\_\+\+S\+T\+A\+C\+K\+\_\+\+O\+V\+E\+R\+F\+L\+O\+W\+\_\+\+C\+H\+E\+C\+K}}). 

For details on various hardware stack implementations, refer to {\ttfamily \hyperlink{tn__arch_8h_a8b4910c153815699beca8afdea88e4b5}{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get()}}.

Depending on the stack implementation used in the particular architecture, the value returned from this function can be one of the following\+:


\begin{DoxyItemize}
\item {\ttfamily (stack\+\_\+top -\/ stack\+\_\+size)} ({\itshape Full descending stack})
\item {\ttfamily (stack\+\_\+top + stack\+\_\+size)} ({\itshape Full ascending stack})
\item {\ttfamily (stack\+\_\+top -\/ stack\+\_\+size + 1)} ({\itshape Empty descending stack})
\item {\ttfamily (stack\+\_\+top + stack\+\_\+size -\/ 1)} ({\itshape Empty ascending stack})
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em stack\+\_\+top} & Top of the stack, returned by {\ttfamily \hyperlink{tn__arch_8h_a8b4910c153815699beca8afdea88e4b5}{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get()}}. \\
\hline
{\em stack\+\_\+size} & Size of the stack in {\ttfamily \hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word}}-\/s, not in bytes. \\
\hline
\end{DoxyParams}
\hypertarget{tn__arch_8h_a4fc5a94ec1abb9b24a14ea108d52defe}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+init@{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+init}}
\index{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+init@{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+init}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}{\bf T\+N\+\_\+\+U\+Word}$\ast$ \+\_\+tn\+\_\+arch\+\_\+stack\+\_\+init (
\begin{DoxyParamCaption}
\item[{{\bf T\+N\+\_\+\+Task\+Body} $\ast$}]{task\+\_\+func, }
\item[{{\bf T\+N\+\_\+\+U\+Word} $\ast$}]{stack\+\_\+top, }
\item[{int}]{stack\+\_\+size, }
\item[{void $\ast$}]{param}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_a4fc5a94ec1abb9b24a14ea108d52defe}


Should put initial C\+P\+U context to the provided stack pointer for new task and return current stack pointer. 

When resulting context gets restored by {\ttfamily \hyperlink{tn__arch_8h_afd5f43f42f5645de164ba6d13d3a4bcf}{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+now\+\_\+nosave()}} or {\ttfamily \hyperlink{tn__arch_8h_a28871f82c82d549092930dd4842e2980}{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+pend()}}, the following conditions should be met\+:


\begin{DoxyItemize}
\item Interrupts are enabled;
\item Return address is set to {\ttfamily \hyperlink{tn__tasks_8h_a23e562731e616f01e325bc9830bcc021}{tn\+\_\+task\+\_\+exit()}}, so that when task body function returns, {\ttfamily \hyperlink{tn__tasks_8h_a23e562731e616f01e325bc9830bcc021}{tn\+\_\+task\+\_\+exit()}} gets automatially called;
\item Argument 0 contains {\ttfamily param} pointer
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em task\+\_\+func} & Pointer to task body function. \\
\hline
{\em stack\+\_\+top} & Top of the stack, returned by {\ttfamily \hyperlink{tn__arch_8h_a8b4910c153815699beca8afdea88e4b5}{\+\_\+tn\+\_\+arch\+\_\+stack\+\_\+top\+\_\+get()}}. \\
\hline
{\em stack\+\_\+size} & Size of the stack in {\ttfamily \hyperlink{tn__arch__example_8h_ab80cba0fe9ffcd9011d53dfeb9e39bf4}{T\+N\+\_\+\+U\+Word}}-\/s, not in bytes. \\
\hline
{\em param} & User-\/provided parameter for task body function.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
current stack pointer (top of the stack) 
\end{DoxyReturn}
\hypertarget{tn__arch_8h_a34ffbae8b6837f7f3014bca9991e2272}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!\+\_\+tn\+\_\+arch\+\_\+inside\+\_\+isr@{\+\_\+tn\+\_\+arch\+\_\+inside\+\_\+isr}}
\index{\+\_\+tn\+\_\+arch\+\_\+inside\+\_\+isr@{\+\_\+tn\+\_\+arch\+\_\+inside\+\_\+isr}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{\+\_\+tn\+\_\+arch\+\_\+inside\+\_\+isr}]{\setlength{\rightskip}{0pt plus 5cm}int \+\_\+tn\+\_\+arch\+\_\+inside\+\_\+isr (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_a34ffbae8b6837f7f3014bca9991e2272}


Should return 1 if {\itshape system I\+S\+R} is currently running, 0 otherwise. 

Refer to the section \hyperlink{interrupts_interrupt_types}{Interrupt types} for details on what is {\itshape system I\+S\+R}. \hypertarget{tn__arch_8h_a024f41d79c823ecac5ed6b83c36f164e}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!\+\_\+tn\+\_\+arch\+\_\+is\+\_\+int\+\_\+disabled@{\+\_\+tn\+\_\+arch\+\_\+is\+\_\+int\+\_\+disabled}}
\index{\+\_\+tn\+\_\+arch\+\_\+is\+\_\+int\+\_\+disabled@{\+\_\+tn\+\_\+arch\+\_\+is\+\_\+int\+\_\+disabled}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{\+\_\+tn\+\_\+arch\+\_\+is\+\_\+int\+\_\+disabled}]{\setlength{\rightskip}{0pt plus 5cm}int \+\_\+tn\+\_\+arch\+\_\+is\+\_\+int\+\_\+disabled (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_a024f41d79c823ecac5ed6b83c36f164e}


Should return 1 if {\itshape system interrupts} are currently disabled, 0 otherwise. 

Refer to the section \hyperlink{interrupts_interrupt_types}{Interrupt types} for details on what is {\itshape system interrupt}. \hypertarget{tn__arch_8h_a28871f82c82d549092930dd4842e2980}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+pend@{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+pend}}
\index{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+pend@{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+pend}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+pend}]{\setlength{\rightskip}{0pt plus 5cm}void \+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+pend (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_a28871f82c82d549092930dd4842e2980}


Called whenever we need to switch context from one task to another. 

This function typically does N\+O\+T switch context; it merely pends it, that is, it sets appropriate interrupt flag. If current level is an application level, interrupt is fired immediately, and context gets switched. Otherwise (if some I\+S\+R is currently running), context switch keeps pending until all I\+S\+R return.

{\bfseries Preconditions\+:}


\begin{DoxyItemize}
\item interrupts are enabled;
\item {\ttfamily \+\_\+tn\+\_\+curr\+\_\+run\+\_\+task} points to currently running (preempted) task;
\item {\ttfamily \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run} points to new task to run.
\end{DoxyItemize}

{\bfseries Actions to perform in actual context switching routine\+:}


\begin{DoxyItemize}
\item save context of the preempted task to its stack;
\item if preprocessor macro {\ttfamily \hyperlink{tn__cfg__dispatch_8h_afafafccc47ed18807179e8909ef18bee}{\+\_\+\+T\+N\+\_\+\+O\+N\+\_\+\+C\+O\+N\+T\+E\+X\+T\+\_\+\+S\+W\+I\+T\+C\+H\+\_\+\+H\+A\+N\+D\+L\+E\+R}} is non-\/zero, call {\ttfamily \+\_\+tn\+\_\+sys\+\_\+on\+\_\+context\+\_\+switch(\+\_\+tn\+\_\+curr\+\_\+run\+\_\+task, \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run);}.
\item set {\ttfamily \+\_\+tn\+\_\+curr\+\_\+run\+\_\+task} to {\ttfamily \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run};
\item restore context of the newly activated task from its stack.
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
{\ttfamily \+\_\+tn\+\_\+curr\+\_\+run\+\_\+task} 

{\ttfamily \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run} 
\end{DoxySeeAlso}
\hypertarget{tn__arch_8h_afd5f43f42f5645de164ba6d13d3a4bcf}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+now\+\_\+nosave@{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+now\+\_\+nosave}}
\index{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+now\+\_\+nosave@{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+now\+\_\+nosave}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+now\+\_\+nosave}]{\setlength{\rightskip}{0pt plus 5cm}void \+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+now\+\_\+nosave (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_afd5f43f42f5645de164ba6d13d3a4bcf}


Called whenever we need to switch context to new task, but don't save current context. 

This happens\+:
\begin{DoxyItemize}
\item At system start, inside {\ttfamily \hyperlink{tn__sys_8h_a62ab25d9d8ca01c02d368968f19e49bf}{tn\+\_\+sys\+\_\+start()}} (well, it is actually called indirectly but from {\ttfamily \hyperlink{tn__arch_8h_aa7c39f947f344a697bcbfe9db10de153}{\+\_\+tn\+\_\+arch\+\_\+sys\+\_\+start()}});
\item At task exit, inside {\ttfamily \hyperlink{tn__tasks_8h_a23e562731e616f01e325bc9830bcc021}{tn\+\_\+task\+\_\+exit()}}.
\end{DoxyItemize}

This function doesn't need to pend context switch, it switches context immediately.

{\bfseries Preconditions\+:}


\begin{DoxyItemize}
\item interrupts are disabled;
\item {\ttfamily \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run} is already set to needed task.
\end{DoxyItemize}

{\bfseries Actions to perform\+:}


\begin{DoxyItemize}
\item if preprocessor macro {\ttfamily \hyperlink{tn__cfg__dispatch_8h_afafafccc47ed18807179e8909ef18bee}{\+\_\+\+T\+N\+\_\+\+O\+N\+\_\+\+C\+O\+N\+T\+E\+X\+T\+\_\+\+S\+W\+I\+T\+C\+H\+\_\+\+H\+A\+N\+D\+L\+E\+R}} is non-\/zero, call {\ttfamily \+\_\+tn\+\_\+sys\+\_\+on\+\_\+context\+\_\+switch(\+\_\+tn\+\_\+curr\+\_\+run\+\_\+task, \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run);}.
\item set {\ttfamily \+\_\+tn\+\_\+curr\+\_\+run\+\_\+task} to {\ttfamily \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run};
\item restore context of the newly activated task from its stack.
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
{\ttfamily \+\_\+tn\+\_\+curr\+\_\+run\+\_\+task} 

{\ttfamily \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run} 
\end{DoxySeeAlso}
\hypertarget{tn__arch_8h_aa7c39f947f344a697bcbfe9db10de153}{\index{tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}!\+\_\+tn\+\_\+arch\+\_\+sys\+\_\+start@{\+\_\+tn\+\_\+arch\+\_\+sys\+\_\+start}}
\index{\+\_\+tn\+\_\+arch\+\_\+sys\+\_\+start@{\+\_\+tn\+\_\+arch\+\_\+sys\+\_\+start}!tn\+\_\+arch.\+h@{tn\+\_\+arch.\+h}}
\subsubsection[{\+\_\+tn\+\_\+arch\+\_\+sys\+\_\+start}]{\setlength{\rightskip}{0pt plus 5cm}void \+\_\+tn\+\_\+arch\+\_\+sys\+\_\+start (
\begin{DoxyParamCaption}
\item[{{\bf T\+N\+\_\+\+U\+Word} $\ast$}]{int\+\_\+stack, }
\item[{unsigned int}]{int\+\_\+stack\+\_\+size}
\end{DoxyParamCaption}
)}}\label{tn__arch_8h_aa7c39f947f344a697bcbfe9db10de153}


Performs first context switch to the first task ({\ttfamily \+\_\+tn\+\_\+next\+\_\+task\+\_\+to\+\_\+run} is already set to needed task). 

Typically, this function just calls {\ttfamily \hyperlink{tn__arch_8h_afd5f43f42f5645de164ba6d13d3a4bcf}{\+\_\+tn\+\_\+arch\+\_\+context\+\_\+switch\+\_\+now\+\_\+nosave()}}, but it also can perform any architecture-\/dependent actions first, if needed. 