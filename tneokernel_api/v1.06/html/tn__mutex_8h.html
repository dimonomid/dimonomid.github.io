<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>TNeo: core/tn_mutex.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-7163754-5', 'auto');
  ga('send', 'pageview');
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">TNeo
   &#160;<span id="projectnumber">v1.06</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4270bfced15e0e73154b13468c7c9ad9.html">core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tn_mutex.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A mutex is an object used to protect shared resources. </p>
<p>There is a lot of confusion about the differences between semaphores and mutexes, so, it's highly recommended that you read a small article by Michael Barr: <a href="http://goo.gl/YprPBW">Mutexes and Semaphores Demystified</a>.</p>
<p>Very short:</p>
<p>While a mutex is seemingly similar to a semaphore with a maximum count of <code>1</code> (the so-called binary semaphore), their usage is very different: the purpose of mutex is to protect a shared resource. A locked mutex is "owned" by the task that locked it, and only that same task may unlock it. This ownership allows you to implement algorithms to prevent priority inversion. So, a mutex is a <em>locking mechanism</em>.</p>
<p>A semaphore, on the other hand, is a <em>signaling mechanism</em>. It's quite legal and encouraged for a semaphore to be acquired in task A, and then signaled from task B or even from an ISR. It may be used in situations like "producer
and consumer", etc.</p>
<p>In addition to the article mentioned above, you may want to look at the <a href="http://goo.gl/ZBReHK">related question on stackoverflow.com</a>. </p><hr/>
<p>Mutex features in TNeo:</p>
<ul>
<li>Recursive locking is supported (if option <code><a class="el" href="tn__cfg__default_8h.html#a2557da78508c4241aceee92475df3581" title="Whether mutexes should allow recursive locking/unlocking. ">TN_MUTEX_REC</a></code> is non-zero);</li>
<li>Deadlock detection (if option <code><a class="el" href="tn__cfg__default_8h.html#a6ed3ec7b0d4338e7f60dde86b7ea5fa4" title="Whether RTOS should detect deadlocks and notify user about them via callback. ">TN_MUTEX_DEADLOCK_DETECT</a></code> is non-zero);</li>
<li>Two protocols available to avoid unbounded priority inversion: priority inheritance and priority ceiling.</li>
</ul>
<p>A discussion about the strengths and weaknesses of each protocol as well as the priority inversions problem is beyond the scope of this document.</p>
<p>The priority inheritance protocol solves the priority inversion problem, but doesn't prevent deadlocks. However, the kernel can notify you if a deadlock has occurred (see <code><a class="el" href="tn__cfg__default_8h.html#a6ed3ec7b0d4338e7f60dde86b7ea5fa4" title="Whether RTOS should detect deadlocks and notify user about them via callback. ">TN_MUTEX_DEADLOCK_DETECT</a></code>).</p>
<p>The priority ceiling protocol prevents deadlocks and chained blocking but it is slower than the priority inheritance protocol.</p>
<dl class="section see"><dt>See also</dt><dd><code><a class="el" href="tn__cfg__default_8h.html#a7ce674edab5345c4b8d2ec251eea18eb" title="Whether mutexes API should be available. ">TN_USE_MUTEXES</a></code> </dd></dl>

<p>Definition in file <a class="el" href="tn__mutex_8h_source.html">tn_mutex.h</a>.</p>
</div>
<p><a href="tn__mutex_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTN__Mutex.html">TN_Mutex</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex.  <a href="structTN__Mutex.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a11357f7bb31a3b380cbe94e0913a5b40"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40">TN_MutexProtocol</a> { <a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40a8edebcfa37593a4d2d541954ce3aea67">TN_MUTEX_PROT_CEILING</a> = 1, 
<a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40ab3f7543f3177c575342d345010b58fa8">TN_MUTEX_PROT_INHERIT</a> = 2
 }</td></tr>
<tr class="memdesc:a11357f7bb31a3b380cbe94e0913a5b40"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex protocol for avoid priority inversion.  <a href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40">More...</a><br /></td></tr>
<tr class="separator:a11357f7bb31a3b380cbe94e0913a5b40"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5ad69fd04d977538ac0d2c2a915e73ca"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__mutex_8h.html#a5ad69fd04d977538ac0d2c2a915e73ca">tn_mutex_create</a> (struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *mutex, enum <a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40">TN_MutexProtocol</a> protocol, int ceil_priority)</td></tr>
<tr class="memdesc:a5ad69fd04d977538ac0d2c2a915e73ca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct the mutex.  <a href="#a5ad69fd04d977538ac0d2c2a915e73ca">More...</a><br /></td></tr>
<tr class="separator:a5ad69fd04d977538ac0d2c2a915e73ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c935ae470f1d36f8d88c254a4d513e4"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__mutex_8h.html#a9c935ae470f1d36f8d88c254a4d513e4">tn_mutex_delete</a> (struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *mutex)</td></tr>
<tr class="memdesc:a9c935ae470f1d36f8d88c254a4d513e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destruct mutex.  <a href="#a9c935ae470f1d36f8d88c254a4d513e4">More...</a><br /></td></tr>
<tr class="separator:a9c935ae470f1d36f8d88c254a4d513e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af52ee42e086af12f699ebfccd057aade"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__mutex_8h.html#af52ee42e086af12f699ebfccd057aade">tn_mutex_lock</a> (struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *mutex, <a class="el" href="tn__common_8h.html#ac885b63d00c063de61cdbd80bf26d8aa">TN_TickCnt</a> timeout)</td></tr>
<tr class="memdesc:af52ee42e086af12f699ebfccd057aade"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lock mutex.  <a href="#af52ee42e086af12f699ebfccd057aade">More...</a><br /></td></tr>
<tr class="separator:af52ee42e086af12f699ebfccd057aade"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5714615cc3623cc3efd404e3ad47787"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__mutex_8h.html#ac5714615cc3623cc3efd404e3ad47787">tn_mutex_lock_polling</a> (struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *mutex)</td></tr>
<tr class="memdesc:ac5714615cc3623cc3efd404e3ad47787"><td class="mdescLeft">&#160;</td><td class="mdescRight">The same as <code><a class="el" href="tn__mutex_8h.html#af52ee42e086af12f699ebfccd057aade" title="Lock mutex. ">tn_mutex_lock()</a></code> with zero timeout.  <a href="#ac5714615cc3623cc3efd404e3ad47787">More...</a><br /></td></tr>
<tr class="separator:ac5714615cc3623cc3efd404e3ad47787"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0a23d98c287786f8115020036a1fb72"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="tn__mutex_8h.html#ae0a23d98c287786f8115020036a1fb72">tn_mutex_unlock</a> (struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *mutex)</td></tr>
<tr class="memdesc:ae0a23d98c287786f8115020036a1fb72"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlock mutex.  <a href="#ae0a23d98c287786f8115020036a1fb72">More...</a><br /></td></tr>
<tr class="separator:ae0a23d98c287786f8115020036a1fb72"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="a11357f7bb31a3b380cbe94e0913a5b40"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40">TN_MutexProtocol</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mutex protocol for avoid priority inversion. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a class="anchor" id="a11357f7bb31a3b380cbe94e0913a5b40a8edebcfa37593a4d2d541954ce3aea67"></a>TN_MUTEX_PROT_CEILING&#160;</td><td class="fielddoc">
<p>Mutex uses priority ceiling protocol. </p>
</td></tr>
<tr><td class="fieldname"><a class="anchor" id="a11357f7bb31a3b380cbe94e0913a5b40ab3f7543f3177c575342d345010b58fa8"></a>TN_MUTEX_PROT_INHERIT&#160;</td><td class="fielddoc">
<p>Mutex uses priority inheritance protocol. </p>
</td></tr>
</table>

<p>Definition at line <a class="el" href="tn__mutex_8h_source.html#l00109">109</a> of file <a class="el" href="tn__mutex_8h_source.html">tn_mutex.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a5ad69fd04d977538ac0d2c2a915e73ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_mutex_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *&#160;</td>
          <td class="paramname"><em>mutex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40">TN_MutexProtocol</a>&#160;</td>
          <td class="paramname"><em>protocol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ceil_priority</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct the mutex. </p>
<p>The field <code>id_mutex</code> should not contain <code><a class="el" href="tn__common_8h.html#ae779dd1f6735f6e139fb70acd004d976abf9427ac5b7701a4bd1b6cff3004e5a5" title="id for mutexes ">TN_ID_MUTEX</a></code>, otherwise, <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> is returned.</p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_int.png" alt="attr_call_int.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mutex</td><td>Pointer to already allocated <code>struct <a class="el" href="structTN__Mutex.html" title="Mutex. ">TN_Mutex</a></code> </td></tr>
    <tr><td class="paramname">protocol</td><td>Mutex protocol: priority ceiling or priority inheritance. See <code>enum <a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40" title="Mutex protocol for avoid priority inversion. ">TN_MutexProtocol</a></code>. </td></tr>
    <tr><td class="paramname">ceil_priority</td><td>Used if only <code>protocol</code> is <code><a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40a8edebcfa37593a4d2d541954ce3aea67" title="Mutex uses priority ceiling protocol. ">TN_MUTEX_PROT_CEILING</a></code>: maximum priority of the task that may lock the mutex.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if mutex was successfully created;</li>
<li>If <code><a class="el" href="tn__cfg__default_8h.html#a1f197294df3276fec431930545acafd5" title="Enables additional param checking for most of the system functions. ">TN_CHECK_PARAM</a></code> is non-zero, additional return code is available: <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code>. </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="a9c935ae470f1d36f8d88c254a4d513e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_mutex_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *&#160;</td>
          <td class="paramname"><em>mutex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destruct mutex. </p>
<p>All tasks that wait for lock the mutex become runnable with <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a3252967d2fdefcfbd4eb720ed4663d84" title="Object for whose event task was waiting is deleted. ">TN_RC_DELETED</a></code> code returned.</p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_ct_sw.png" alt="attr_call_ct_sw.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mutex</td><td>mutex to destruct</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if mutex was successfully destroyed;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a886368391507ae426bfdedc38284db9d" title="Wrong context error: returned if function is called from non-acceptable context. ">TN_RC_WCONTEXT</a></code> if called from wrong context;</li>
<li>If <code><a class="el" href="tn__cfg__default_8h.html#a1f197294df3276fec431930545acafd5" title="Enables additional param checking for most of the system functions. ">TN_CHECK_PARAM</a></code> is non-zero, additional return codes are available: <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> and <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a2a2df8fecee990d279889924926bf101" title="Returned when user tries to perform some operation on invalid object (mutex, semaphore, etc). ">TN_RC_INVALID_OBJ</a></code>. </li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="af52ee42e086af12f699ebfccd057aade"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_mutex_lock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *&#160;</td>
          <td class="paramname"><em>mutex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="tn__common_8h.html#ac885b63d00c063de61cdbd80bf26d8aa">TN_TickCnt</a>&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Lock mutex. </p>
<ul>
<li>If the mutex is not locked, function immediately locks the mutex and returns <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code>.</li>
<li>If the mutex is already locked by the same task, lock count is merely incremented and <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> is returned immediately.</li>
<li>If the mutex is locked by different task, behavior depends on <code>timeout</code> value: refer to <code><a class="el" href="tn__common_8h.html#ac885b63d00c063de61cdbd80bf26d8aa" title="Type for system tick count, it is used by the kernel to represent absolute tick count value as well a...">TN_TickCnt</a></code>.</li>
</ul>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_ct_sw.png" alt="attr_call_ct_sw.png"/>
</div>
  <div class="image">
<img src="attr_timeout.png" alt="attr_timeout.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mutex</td><td>mutex to lock </td></tr>
    <tr><td class="paramname">timeout</td><td>refer to <code><a class="el" href="tn__common_8h.html#ac885b63d00c063de61cdbd80bf26d8aa" title="Type for system tick count, it is used by the kernel to represent absolute tick count value as well a...">TN_TickCnt</a></code></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if mutex is successfully locked or if lock count was merely incremented (this is possible if recursive locking is enabled, see <code><a class="el" href="tn__cfg__default_8h.html#a2557da78508c4241aceee92475df3581" title="Whether mutexes should allow recursive locking/unlocking. ">TN_MUTEX_REC</a></code>)</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a886368391507ae426bfdedc38284db9d" title="Wrong context error: returned if function is called from non-acceptable context. ">TN_RC_WCONTEXT</a></code> if called from wrong context;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a2c83a60bf543df45b5045d6f7fbc7d0c" title="Illegal usage. ">TN_RC_ILLEGAL_USE</a></code><ul>
<li>if mutex protocol is <code><a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40a8edebcfa37593a4d2d541954ce3aea67" title="Mutex uses priority ceiling protocol. ">TN_MUTEX_PROT_CEILING</a></code> and calling task's priority is higher than <code>ceil_priority</code> given to <code><a class="el" href="tn__mutex_8h.html#a5ad69fd04d977538ac0d2c2a915e73ca" title="Construct the mutex. ">tn_mutex_create()</a></code></li>
<li>if recursive locking is disabled (see <code><a class="el" href="tn__cfg__default_8h.html#a2557da78508c4241aceee92475df3581" title="Whether mutexes should allow recursive locking/unlocking. ">TN_MUTEX_REC</a></code>) and the mutex is already locked by calling task</li>
</ul>
</li>
<li>Other possible return codes depend on <code>timeout</code> value, refer to <code><a class="el" href="tn__common_8h.html#ac885b63d00c063de61cdbd80bf26d8aa" title="Type for system tick count, it is used by the kernel to represent absolute tick count value as well a...">TN_TickCnt</a></code></li>
<li>If <code><a class="el" href="tn__cfg__default_8h.html#a1f197294df3276fec431930545acafd5" title="Enables additional param checking for most of the system functions. ">TN_CHECK_PARAM</a></code> is non-zero, additional return codes are available: <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> and <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a2a2df8fecee990d279889924926bf101" title="Returned when user tries to perform some operation on invalid object (mutex, semaphore, etc). ">TN_RC_INVALID_OBJ</a></code>.</li>
</ul>
</dd></dl>
<dl class="section see"><dt>See also</dt><dd><code><a class="el" href="tn__mutex_8h.html#a11357f7bb31a3b380cbe94e0913a5b40" title="Mutex protocol for avoid priority inversion. ">TN_MutexProtocol</a></code> </dd></dl>

</div>
</div>
<a class="anchor" id="ac5714615cc3623cc3efd404e3ad47787"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_mutex_lock_polling </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *&#160;</td>
          <td class="paramname"><em>mutex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The same as <code><a class="el" href="tn__mutex_8h.html#af52ee42e086af12f699ebfccd057aade" title="Lock mutex. ">tn_mutex_lock()</a></code> with zero timeout. </p>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_ct_sw.png" alt="attr_call_ct_sw.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small> </p>

</div>
</div>
<a class="anchor" id="ae0a23d98c287786f8115020036a1fb72"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876">TN_RCode</a> tn_mutex_unlock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structTN__Mutex.html">TN_Mutex</a> *&#160;</td>
          <td class="paramname"><em>mutex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlock mutex. </p>
<ul>
<li>If mutex is not locked or locked by different task, <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a2c83a60bf543df45b5045d6f7fbc7d0c" title="Illegal usage. ">TN_RC_ILLEGAL_USE</a></code> is returned.</li>
<li>If mutex is already locked by calling task, lock count is decremented. Now, if lock count is zero, mutex gets unlocked (and if there are task(s) waiting for mutex, the first one from the wait queue locks the mutex). Otherwise, mutex remains locked with lock count decremented and function returns <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code>.</li>
</ul>
<div class="image">
<img src="attr_call_task.png" alt="attr_call_task.png"/>
</div>
  <div class="image">
<img src="attr_call_ct_sw.png" alt="attr_call_ct_sw.png"/>
</div>
  <small><em>(refer to <a class="el" href="legend.html">Legend</a> for details)</em></small></p>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876afb291924237186f5765865256c75e639" title="Successful operation. ">TN_RC_OK</a></code> if mutex is unlocked of if lock count was merely decremented (this is possible if recursive locking is enabled, see <code><a class="el" href="tn__cfg__default_8h.html#a2557da78508c4241aceee92475df3581" title="Whether mutexes should allow recursive locking/unlocking. ">TN_MUTEX_REC</a></code>)</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a886368391507ae426bfdedc38284db9d" title="Wrong context error: returned if function is called from non-acceptable context. ">TN_RC_WCONTEXT</a></code> if called from wrong context;</li>
<li><code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a2c83a60bf543df45b5045d6f7fbc7d0c" title="Illegal usage. ">TN_RC_ILLEGAL_USE</a></code> if mutex is either not locked or locked by different task</li>
<li>If <code><a class="el" href="tn__cfg__default_8h.html#a1f197294df3276fec431930545acafd5" title="Enables additional param checking for most of the system functions. ">TN_CHECK_PARAM</a></code> is non-zero, additional return codes are available: <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a89909a6426b477a38496a1be67590e68" title="This code is returned by most of the kernel functions when wrong params were given to function...">TN_RC_WPARAM</a></code> and <code><a class="el" href="tn__common_8h.html#aa43bd3da1ad4c1e61224b5f23b369876a2a2df8fecee990d279889924926bf101" title="Returned when user tries to perform some operation on invalid object (mutex, semaphore, etc). ">TN_RC_INVALID_OBJ</a></code>. </li>
</ul>
</dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 2 2015 04:05:02 for TNeo by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
