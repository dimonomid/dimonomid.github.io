\hypertarget{tn__sem_8h}{}\doxysection{core/tn\+\_\+sem.h File Reference}
\label{tn__sem_8h}\index{core/tn\_sem.h@{core/tn\_sem.h}}


\doxysubsection{Detailed Description}
A semaphore\+: an object to provide signaling mechanism.

There is a lot of confusion about differences between semaphores and mutexes, so, it\textquotesingle{}s quite recommended to read small article by Michael Barr\+: \href{http://goo.gl/YprPBW}{\texttt{ Mutexes and Semaphores Demystified}}.

Very short\+:

While mutex is seemingly similar to a semaphore with maximum count of {\ttfamily 1} (the so-\/called binary semaphore), their usage is very different\+: the purpose of mutex is to protect shared resource. A locked mutex is \char`\"{}owned\char`\"{} by the task that locked it, and only the same task may unlock it. This ownership allows to implement algorithms to prevent priority inversion. So, mutex is a {\itshape locking mechanism}.

Semaphore, on the other hand, is {\itshape signaling mechanism}. It\textquotesingle{}s quite legal and encouraged for semaphore to be waited for in the task A, and then signaled from task B or even from I\+SR. It may be used in situations like \char`\"{}producer
and consumer\char`\"{}, etc.

In addition to the article mentioned above, you may want to look at the \href{http://goo.gl/ZBReHK}{\texttt{ related question on stackoverflow.\+com}}. \doxysubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}}
\begin{DoxyCompactList}\small\item\em Semaphore. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} \mbox{\hyperlink{tn__sem_8h_a302b9a0fbb1843e38d95fdc1390d5c31}{tn\+\_\+sem\+\_\+create}} (struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$sem, int start\+\_\+count, int max\+\_\+count)
\begin{DoxyCompactList}\small\item\em Construct the semaphore. \end{DoxyCompactList}\item 
enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} \mbox{\hyperlink{tn__sem_8h_a427022246912c9f2bea8a14033b4d103}{tn\+\_\+sem\+\_\+delete}} (struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$sem)
\begin{DoxyCompactList}\small\item\em Destruct the semaphore. \end{DoxyCompactList}\item 
enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} \mbox{\hyperlink{tn__sem_8h_a39f52729fc651ccef7696310d3642a24}{tn\+\_\+sem\+\_\+signal}} (struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$sem)
\begin{DoxyCompactList}\small\item\em Signal the semaphore. \end{DoxyCompactList}\item 
enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} \mbox{\hyperlink{tn__sem_8h_a215fd97b86fc63192106bb30b0574d14}{tn\+\_\+sem\+\_\+isignal}} (struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$sem)
\begin{DoxyCompactList}\small\item\em The same as {\ttfamily \mbox{\hyperlink{tn__sem_8h_a39f52729fc651ccef7696310d3642a24}{tn\+\_\+sem\+\_\+signal()}}} but for using in the I\+SR. \end{DoxyCompactList}\item 
enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} \mbox{\hyperlink{tn__sem_8h_acfed2a27719c87638d2eb6edfdeea150}{tn\+\_\+sem\+\_\+wait}} (struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$sem, \mbox{\hyperlink{tn__common_8h_ac885b63d00c063de61cdbd80bf26d8aa}{T\+N\+\_\+\+Tick\+Cnt}} timeout)
\begin{DoxyCompactList}\small\item\em Wait for the semaphore. \end{DoxyCompactList}\item 
enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} \mbox{\hyperlink{tn__sem_8h_a7dd4429a9f3942764b23025f2f2e364e}{tn\+\_\+sem\+\_\+wait\+\_\+polling}} (struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$sem)
\begin{DoxyCompactList}\small\item\em The same as {\ttfamily \mbox{\hyperlink{tn__sem_8h_acfed2a27719c87638d2eb6edfdeea150}{tn\+\_\+sem\+\_\+wait()}}} with zero timeout. \end{DoxyCompactList}\item 
enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} \mbox{\hyperlink{tn__sem_8h_a22e181857dbc681f962cfda5d34d71c0}{tn\+\_\+sem\+\_\+iwait\+\_\+polling}} (struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$sem)
\begin{DoxyCompactList}\small\item\em The same as {\ttfamily \mbox{\hyperlink{tn__sem_8h_acfed2a27719c87638d2eb6edfdeea150}{tn\+\_\+sem\+\_\+wait()}}} with zero timeout, but for using in the I\+SR. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{tn__sem_8h_a302b9a0fbb1843e38d95fdc1390d5c31}\label{tn__sem_8h_a302b9a0fbb1843e38d95fdc1390d5c31}} 
\index{tn\_sem.h@{tn\_sem.h}!tn\_sem\_create@{tn\_sem\_create}}
\index{tn\_sem\_create@{tn\_sem\_create}!tn\_sem.h@{tn\_sem.h}}
\doxysubsubsection{\texorpdfstring{tn\_sem\_create()}{tn\_sem\_create()}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} tn\+\_\+sem\+\_\+create (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$}]{sem,  }\item[{int}]{start\+\_\+count,  }\item[{int}]{max\+\_\+count }\end{DoxyParamCaption})}



Construct the semaphore. 

{\ttfamily id\+\_\+sem} field should not contain {\ttfamily \#T\+N\+\_\+\+I\+D\+\_\+\+S\+E\+M\+A\+P\+H\+O\+RE}, otherwise, {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+W\+P\+A\+R\+AM} is returned.

  \includegraphics{attr_call_task.png}    \includegraphics{attr_call_int.png}  
\footnotesize {\itshape (refer to \mbox{\hyperlink{legend}{Legend}} for details)}
\normalsize 


\begin{DoxyParams}{Parameters}
{\em sem} & Pointer to already allocated {\ttfamily struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}}} \\
\hline
{\em start\+\_\+count} & Initial counter value, typically it is equal to {\ttfamily max\+\_\+count} \\
\hline
{\em max\+\_\+count} & Maximum counter value.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+OK} if semaphore was successfully created;
\item If {\ttfamily \#T\+N\+\_\+\+C\+H\+E\+C\+K\+\_\+\+P\+A\+R\+AM} is non-\/zero, additional return code is available\+: {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+W\+P\+A\+R\+AM}. 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{tn__sem_8h_a427022246912c9f2bea8a14033b4d103}\label{tn__sem_8h_a427022246912c9f2bea8a14033b4d103}} 
\index{tn\_sem.h@{tn\_sem.h}!tn\_sem\_delete@{tn\_sem\_delete}}
\index{tn\_sem\_delete@{tn\_sem\_delete}!tn\_sem.h@{tn\_sem.h}}
\doxysubsubsection{\texorpdfstring{tn\_sem\_delete()}{tn\_sem\_delete()}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} tn\+\_\+sem\+\_\+delete (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$}]{sem }\end{DoxyParamCaption})}



Destruct the semaphore. 

All tasks that wait for the semaphore become runnable with {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+D\+E\+L\+E\+T\+ED} code returned.

  \includegraphics{attr_call_task.png}    \includegraphics{attr_call_ct_sw.png}  
\footnotesize {\itshape (refer to \mbox{\hyperlink{legend}{Legend}} for details)}
\normalsize 


\begin{DoxyParams}{Parameters}
{\em sem} & semaphore to destruct\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+OK} if semaphore was successfully deleted;
\item {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+W\+C\+O\+N\+T\+E\+XT} if called from wrong context;
\item If {\ttfamily \#T\+N\+\_\+\+C\+H\+E\+C\+K\+\_\+\+P\+A\+R\+AM} is non-\/zero, additional return codes are available\+: {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+W\+P\+A\+R\+AM} and {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+O\+BJ}. 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{tn__sem_8h_a39f52729fc651ccef7696310d3642a24}\label{tn__sem_8h_a39f52729fc651ccef7696310d3642a24}} 
\index{tn\_sem.h@{tn\_sem.h}!tn\_sem\_signal@{tn\_sem\_signal}}
\index{tn\_sem\_signal@{tn\_sem\_signal}!tn\_sem.h@{tn\_sem.h}}
\doxysubsubsection{\texorpdfstring{tn\_sem\_signal()}{tn\_sem\_signal()}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} tn\+\_\+sem\+\_\+signal (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$}]{sem }\end{DoxyParamCaption})}



Signal the semaphore. 

If current semaphore counter ({\ttfamily count}) is less than {\ttfamily max\+\_\+count}, counter is incremented by one, and first task (if any) that \mbox{\hyperlink{tn__sem_8h_acfed2a27719c87638d2eb6edfdeea150}{waits}} for the semaphore becomes runnable with {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+OK} returned from {\ttfamily \mbox{\hyperlink{tn__sem_8h_acfed2a27719c87638d2eb6edfdeea150}{tn\+\_\+sem\+\_\+wait()}}}.

if semaphore counter is already has its max value, no action performed and {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+O\+V\+E\+R\+F\+L\+OW} is returned

  \includegraphics{attr_call_task.png}    \includegraphics{attr_call_ct_sw.png}  
\footnotesize {\itshape (refer to \mbox{\hyperlink{legend}{Legend}} for details)}
\normalsize 


\begin{DoxyParams}{Parameters}
{\em sem} & semaphore to signal\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+OK} if successful
\item {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+W\+C\+O\+N\+T\+E\+XT} if called from wrong context;
\item {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+O\+V\+E\+R\+F\+L\+OW} if {\ttfamily count} is already at maximum value ({\ttfamily max\+\_\+count})
\item If {\ttfamily \#T\+N\+\_\+\+C\+H\+E\+C\+K\+\_\+\+P\+A\+R\+AM} is non-\/zero, additional return codes are available\+: {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+W\+P\+A\+R\+AM} and {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+O\+BJ}. 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{tn__sem_8h_a215fd97b86fc63192106bb30b0574d14}\label{tn__sem_8h_a215fd97b86fc63192106bb30b0574d14}} 
\index{tn\_sem.h@{tn\_sem.h}!tn\_sem\_isignal@{tn\_sem\_isignal}}
\index{tn\_sem\_isignal@{tn\_sem\_isignal}!tn\_sem.h@{tn\_sem.h}}
\doxysubsubsection{\texorpdfstring{tn\_sem\_isignal()}{tn\_sem\_isignal()}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} tn\+\_\+sem\+\_\+isignal (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$}]{sem }\end{DoxyParamCaption})}



The same as {\ttfamily \mbox{\hyperlink{tn__sem_8h_a39f52729fc651ccef7696310d3642a24}{tn\+\_\+sem\+\_\+signal()}}} but for using in the I\+SR. 

  \includegraphics{attr_call_int.png}    \includegraphics{attr_call_ct_sw.png}  
\footnotesize {\itshape (refer to \mbox{\hyperlink{legend}{Legend}} for details)}
\normalsize  \mbox{\Hypertarget{tn__sem_8h_acfed2a27719c87638d2eb6edfdeea150}\label{tn__sem_8h_acfed2a27719c87638d2eb6edfdeea150}} 
\index{tn\_sem.h@{tn\_sem.h}!tn\_sem\_wait@{tn\_sem\_wait}}
\index{tn\_sem\_wait@{tn\_sem\_wait}!tn\_sem.h@{tn\_sem.h}}
\doxysubsubsection{\texorpdfstring{tn\_sem\_wait()}{tn\_sem\_wait()}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} tn\+\_\+sem\+\_\+wait (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$}]{sem,  }\item[{\mbox{\hyperlink{tn__common_8h_ac885b63d00c063de61cdbd80bf26d8aa}{T\+N\+\_\+\+Tick\+Cnt}}}]{timeout }\end{DoxyParamCaption})}



Wait for the semaphore. 

If the current semaphore counter ({\ttfamily count}) is non-\/zero, it is decremented and {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+OK} is returned. Otherwise, behavior depends on {\ttfamily timeout} value\+: task might switch to \mbox{\hyperlink{tn__tasks_8h_a5e12e8a0ab280b515f44bf3fee1210a6aaa3dfaf2bb5992e0cef981618ce30d56}{{\ttfamily W\+A\+IT}}} state until someone \mbox{\hyperlink{tn__sem_8h_a39f52729fc651ccef7696310d3642a24}{signaled}} the semaphore or until the {\ttfamily timeout} expired. refer to {\ttfamily \#T\+N\+\_\+\+Tick\+Cnt}.

  \includegraphics{attr_call_task.png}    \includegraphics{attr_call_ct_sw.png}    \includegraphics{attr_timeout.png}  
\footnotesize {\itshape (refer to \mbox{\hyperlink{legend}{Legend}} for details)}
\normalsize 


\begin{DoxyParams}{Parameters}
{\em sem} & semaphore to wait for \\
\hline
{\em timeout} & refer to {\ttfamily \#T\+N\+\_\+\+Tick\+Cnt}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\begin{DoxyItemize}
\item {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+OK} if waiting was successfull
\item Other possible return codes depend on {\ttfamily timeout} value, refer to {\ttfamily \#T\+N\+\_\+\+Tick\+Cnt}
\item If {\ttfamily \#T\+N\+\_\+\+C\+H\+E\+C\+K\+\_\+\+P\+A\+R\+AM} is non-\/zero, additional return codes are available\+: {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+W\+P\+A\+R\+AM} and {\ttfamily \#T\+N\+\_\+\+R\+C\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+O\+BJ}. 
\end{DoxyItemize}
\end{DoxyReturn}
\mbox{\Hypertarget{tn__sem_8h_a7dd4429a9f3942764b23025f2f2e364e}\label{tn__sem_8h_a7dd4429a9f3942764b23025f2f2e364e}} 
\index{tn\_sem.h@{tn\_sem.h}!tn\_sem\_wait\_polling@{tn\_sem\_wait\_polling}}
\index{tn\_sem\_wait\_polling@{tn\_sem\_wait\_polling}!tn\_sem.h@{tn\_sem.h}}
\doxysubsubsection{\texorpdfstring{tn\_sem\_wait\_polling()}{tn\_sem\_wait\_polling()}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} tn\+\_\+sem\+\_\+wait\+\_\+polling (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$}]{sem }\end{DoxyParamCaption})}



The same as {\ttfamily \mbox{\hyperlink{tn__sem_8h_acfed2a27719c87638d2eb6edfdeea150}{tn\+\_\+sem\+\_\+wait()}}} with zero timeout. 

  \includegraphics{attr_call_task.png}    \includegraphics{attr_call_ct_sw.png}  
\footnotesize {\itshape (refer to \mbox{\hyperlink{legend}{Legend}} for details)}
\normalsize  \mbox{\Hypertarget{tn__sem_8h_a22e181857dbc681f962cfda5d34d71c0}\label{tn__sem_8h_a22e181857dbc681f962cfda5d34d71c0}} 
\index{tn\_sem.h@{tn\_sem.h}!tn\_sem\_iwait\_polling@{tn\_sem\_iwait\_polling}}
\index{tn\_sem\_iwait\_polling@{tn\_sem\_iwait\_polling}!tn\_sem.h@{tn\_sem.h}}
\doxysubsubsection{\texorpdfstring{tn\_sem\_iwait\_polling()}{tn\_sem\_iwait\_polling()}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{tn__common_8h_aa43bd3da1ad4c1e61224b5f23b369876}{T\+N\+\_\+\+R\+Code}} tn\+\_\+sem\+\_\+iwait\+\_\+polling (\begin{DoxyParamCaption}\item[{struct \mbox{\hyperlink{structTN__Sem}{T\+N\+\_\+\+Sem}} $\ast$}]{sem }\end{DoxyParamCaption})}



The same as {\ttfamily \mbox{\hyperlink{tn__sem_8h_acfed2a27719c87638d2eb6edfdeea150}{tn\+\_\+sem\+\_\+wait()}}} with zero timeout, but for using in the I\+SR. 

  \includegraphics{attr_call_int.png}    \includegraphics{attr_call_ct_sw.png}  
\footnotesize {\itshape (refer to \mbox{\hyperlink{legend}{Legend}} for details)}
\normalsize  