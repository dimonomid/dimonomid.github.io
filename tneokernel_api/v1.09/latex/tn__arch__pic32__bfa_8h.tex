\hypertarget{tn__arch__pic32__bfa_8h}{}\doxysection{arch/pic32/tn\+\_\+arch\+\_\+pic32\+\_\+bfa.h File Reference}
\label{tn__arch__pic32__bfa_8h}\index{arch/pic32/tn\_arch\_pic32\_bfa.h@{arch/pic32/tn\_arch\_pic32\_bfa.h}}


\doxysubsection{Detailed Description}
Atomic bit-\/field access macros for P\+I\+C24/ds\+P\+IC.

Initially, the code was taken from the \href{http://www.pic24.ru/doku.php/articles/mchp/c30_atomic_access}{\texttt{ article by Alex Borisov (russian)}}, and modified a bit.

The kernel would not probably provide that kind of functionality, but the kernel itself needs it, so, it is made public so that application can use it too. \doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{tn__arch__pic32__bfa_8h_afb3b3db3cf42fd7a24eff3f5e5447ae6}\label{tn__arch__pic32__bfa_8h_afb3b3db3cf42fd7a24eff3f5e5447ae6}} 
\#define \mbox{\hyperlink{tn__arch__pic32__bfa_8h_afb3b3db3cf42fd7a24eff3f5e5447ae6}{T\+N\+\_\+\+B\+F\+A\+\_\+\+S\+ET}}~0x1111
\begin{DoxyCompactList}\small\item\em Command for {\ttfamily \mbox{\hyperlink{tn__arch__pic32__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{T\+N\+\_\+\+B\+F\+A()}}} macro\+: Set bits in the bit field by mask; {\ttfamily ...} macro param should be set to the bit mask to set. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{tn__arch__pic32__bfa_8h_aea0ed6f4978ea16f626851f17b93a9c0}\label{tn__arch__pic32__bfa_8h_aea0ed6f4978ea16f626851f17b93a9c0}} 
\#define \mbox{\hyperlink{tn__arch__pic32__bfa_8h_aea0ed6f4978ea16f626851f17b93a9c0}{T\+N\+\_\+\+B\+F\+A\+\_\+\+C\+LR}}~0x2222
\begin{DoxyCompactList}\small\item\em Command for {\ttfamily \mbox{\hyperlink{tn__arch__pic32__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{T\+N\+\_\+\+B\+F\+A()}}} macro\+: Clear bits in the bit field by mask; {\ttfamily ...} macro param should be set to the bit mask to clear. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{tn__arch__pic32__bfa_8h_a5a6d5f573973d827c6eda13675cb6996}\label{tn__arch__pic32__bfa_8h_a5a6d5f573973d827c6eda13675cb6996}} 
\#define \mbox{\hyperlink{tn__arch__pic32__bfa_8h_a5a6d5f573973d827c6eda13675cb6996}{T\+N\+\_\+\+B\+F\+A\+\_\+\+I\+NV}}~0x3333
\begin{DoxyCompactList}\small\item\em Command for {\ttfamily \mbox{\hyperlink{tn__arch__pic32__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{T\+N\+\_\+\+B\+F\+A()}}} macro\+: Invert bits in the bit field by mask; {\ttfamily ...} macro param should be set to the bit mask to invert. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{tn__arch__pic32__bfa_8h_a883fc2ffdb105d460e575de78c877b62}\label{tn__arch__pic32__bfa_8h_a883fc2ffdb105d460e575de78c877b62}} 
\#define \mbox{\hyperlink{tn__arch__pic32__bfa_8h_a883fc2ffdb105d460e575de78c877b62}{T\+N\+\_\+\+B\+F\+A\+\_\+\+WR}}~0x\+A\+A\+AA
\begin{DoxyCompactList}\small\item\em Command for {\ttfamily \mbox{\hyperlink{tn__arch__pic32__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{T\+N\+\_\+\+B\+F\+A()}}} macro\+: Write bit field; {\ttfamily ...} macro param should be set to the value to write. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{tn__arch__pic32__bfa_8h_ac2d2bd0a156045085b452360be0d621b}\label{tn__arch__pic32__bfa_8h_ac2d2bd0a156045085b452360be0d621b}} 
\#define \mbox{\hyperlink{tn__arch__pic32__bfa_8h_ac2d2bd0a156045085b452360be0d621b}{T\+N\+\_\+\+B\+F\+A\+\_\+\+RD}}~0x\+B\+B\+BB
\begin{DoxyCompactList}\small\item\em Command for {\ttfamily \mbox{\hyperlink{tn__arch__pic32__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{T\+N\+\_\+\+B\+F\+A()}}} macro\+: Read bit field; {\ttfamily ...} macro param ignored. \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{tn__arch__pic32__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{T\+N\+\_\+\+B\+FA}}(comm,  reg\+\_\+name,  field\+\_\+name, ...)
\begin{DoxyCompactList}\small\item\em Macro for atomic access to the structure bit field. \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{tn__arch__pic32__bfa_8h_a8d4b939f57687bf93c982917100c064b}{T\+N\+\_\+\+B\+F\+AR}}(comm,  reg\+\_\+name,  lower,  upper, ...)
\begin{DoxyCompactList}\small\item\em Macro for atomic access to the structure bit field specified as a range. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{tn__arch__pic32__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}\label{tn__arch__pic32__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}} 
\index{tn\_arch\_pic32\_bfa.h@{tn\_arch\_pic32\_bfa.h}!TN\_BFA@{TN\_BFA}}
\index{TN\_BFA@{TN\_BFA}!tn\_arch\_pic32\_bfa.h@{tn\_arch\_pic32\_bfa.h}}
\doxysubsubsection{\texorpdfstring{TN\_BFA}{TN\_BFA}}
{\footnotesize\ttfamily \#define T\+N\+\_\+\+B\+FA(\begin{DoxyParamCaption}\item[{}]{comm,  }\item[{}]{reg\+\_\+name,  }\item[{}]{field\+\_\+name,  }\item[{}]{... }\end{DoxyParamCaption})}



Macro for atomic access to the structure bit field. 

The {\ttfamily B\+FA} acronym means Bit Field Access.


\begin{DoxyParams}{Parameters}
{\em comm} & command to execute\+:
\begin{DoxyItemize}
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+WR} -\/ write bit field
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+RD} -\/ read bit field
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+S\+ET} -\/ set bits by mask
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+C\+LR} -\/ clear bits by mask
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+I\+NV} -\/ invert bits by mask
\end{DoxyItemize}\\
\hline
{\em reg\+\_\+name} & register name ({\ttfamily P\+O\+R\+TA}, {\ttfamily C\+M\+C\+ON}, ...).\\
\hline
{\em field\+\_\+name} & structure field name\\
\hline
{\em ...} & used if only {\ttfamily comm != \#T\+N\+\_\+\+B\+F\+A\+\_\+\+RD}. Meaning depends on the {\ttfamily comm}, see comments for specific command\+: {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+WR}, etc.\\
\hline
\end{DoxyParams}
Usage examples\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{int} a = 0x02;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//-\/-\/ Set third bit of the INT0IP field in the IPC0 register:}}
\DoxyCodeLine{\textcolor{comment}{//   IPC0bits.INT0IP |= (1 << 2);}}
\DoxyCodeLine{\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{TN\_BFA}}(\mbox{\hyperlink{tn__arch__pic24__bfa_8h_afb3b3db3cf42fd7a24eff3f5e5447ae6}{TN\_BFA\_SET}}, IPC0, INT0IP, (1 << 2));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//-\/-\/ Clear second bit of the INT0IP field in the IPC0 register:}}
\DoxyCodeLine{\textcolor{comment}{//   IPC0bits.INT0IP \&= \string~(1 << 1);}}
\DoxyCodeLine{\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{TN\_BFA}}(\mbox{\hyperlink{tn__arch__pic24__bfa_8h_aea0ed6f4978ea16f626851f17b93a9c0}{TN\_BFA\_CLR}}, IPC0, INT0IP, (1 << 1));}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//-\/-\/ Invert two less-\/significant bits of the INT0IP field }}
\DoxyCodeLine{\textcolor{comment}{//   in the IPC0 register:}}
\DoxyCodeLine{\textcolor{comment}{//   IPC0bits.INT0IP \string^= 0x03;}}
\DoxyCodeLine{\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{TN\_BFA}}(\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a5a6d5f573973d827c6eda13675cb6996}{TN\_BFA\_INV}}, IPC0, INT0IP, 0x03);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//-\/-\/ Write value 0x05 to the INT0IP field of the IPC0 register:}}
\DoxyCodeLine{\textcolor{comment}{//   IPC0bits.INT0IP = 0x05;}}
\DoxyCodeLine{\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{TN\_BFA}}(\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a883fc2ffdb105d460e575de78c877b62}{TN\_BFA\_WR}}, IPC0, INT0IP, 0x05);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//-\/-\/ Write value of the variable a to the INT0IP field of the IPC0 }}
\DoxyCodeLine{\textcolor{comment}{//   register:}}
\DoxyCodeLine{\textcolor{comment}{//   IPC0bits.INT0IP = a;}}
\DoxyCodeLine{\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{TN\_BFA}}(\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a883fc2ffdb105d460e575de78c877b62}{TN\_BFA\_WR}}, IPC0, INT0IP, a);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//-\/-\/ Read the value that is stored in the INT0IP field of the IPC0 }}
\DoxyCodeLine{\textcolor{comment}{//   register, to the int variable a:}}
\DoxyCodeLine{\textcolor{comment}{//   int a = IPC0bits.INT0IP;}}
\DoxyCodeLine{a = \mbox{\hyperlink{tn__arch__pic24__bfa_8h_a0ab285a4620fe66e07b62e83c199ff54}{TN\_BFA}}(\mbox{\hyperlink{tn__arch__pic24__bfa_8h_ac2d2bd0a156045085b452360be0d621b}{TN\_BFA\_RD}}, IPC0, INT0IP);}
\end{DoxyCode}
 

Definition at line 154 of file tn\+\_\+arch\+\_\+pic32\+\_\+bfa.\+h.

\mbox{\Hypertarget{tn__arch__pic32__bfa_8h_a8d4b939f57687bf93c982917100c064b}\label{tn__arch__pic32__bfa_8h_a8d4b939f57687bf93c982917100c064b}} 
\index{tn\_arch\_pic32\_bfa.h@{tn\_arch\_pic32\_bfa.h}!TN\_BFAR@{TN\_BFAR}}
\index{TN\_BFAR@{TN\_BFAR}!tn\_arch\_pic32\_bfa.h@{tn\_arch\_pic32\_bfa.h}}
\doxysubsubsection{\texorpdfstring{TN\_BFAR}{TN\_BFAR}}
{\footnotesize\ttfamily \#define T\+N\+\_\+\+B\+F\+AR(\begin{DoxyParamCaption}\item[{}]{comm,  }\item[{}]{reg\+\_\+name,  }\item[{}]{lower,  }\item[{}]{upper,  }\item[{}]{... }\end{DoxyParamCaption})}



Macro for atomic access to the structure bit field specified as a range. 


\begin{DoxyParams}{Parameters}
{\em comm} & command to execute\+:
\begin{DoxyItemize}
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+WR} -\/ write bit field
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+RD} -\/ read bit field
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+S\+ET} -\/ set bits by mask
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+C\+LR} -\/ clear bits by mask
\item {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+I\+NV} -\/ invert bits by mask
\end{DoxyItemize}\\
\hline
{\em reg\+\_\+name} & variable name ({\ttfamily P\+O\+R\+TA}, {\ttfamily C\+M\+C\+ON}, ...). Variable should be in the near memory (first 8 KB)\\
\hline
{\em lower} & number of lowest affected bit of the field\\
\hline
{\em upper} & number of highest affected bit of the field\\
\hline
{\em ...} & used if only {\ttfamily comm != \#T\+N\+\_\+\+B\+F\+A\+\_\+\+RD}. Meaning depends on the {\ttfamily comm}, see comments for specific command\+: {\ttfamily \#T\+N\+\_\+\+B\+F\+A\+\_\+\+WR}, etc.\\
\hline
\end{DoxyParams}
Usage examples\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{int} a = 0x02;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//-\/-\/ Write constant 0xaa to the least significant byte of the TRISB}}
\DoxyCodeLine{\textcolor{comment}{//   register:}}
\DoxyCodeLine{\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a8d4b939f57687bf93c982917100c064b}{TN\_BFAR}}(\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a883fc2ffdb105d460e575de78c877b62}{TN\_BFA\_WR}}, TRISB, 0, 7, 0xaa);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//-\/-\/ Invert least significant nibble of the most significant byte }}
\DoxyCodeLine{\textcolor{comment}{//   in the register TRISB:}}
\DoxyCodeLine{\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a8d4b939f57687bf93c982917100c064b}{TN\_BFAR}}(\mbox{\hyperlink{tn__arch__pic24__bfa_8h_a5a6d5f573973d827c6eda13675cb6996}{TN\_BFA\_INV}}, TRISB, 8, 15, 0x0f);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//-\/-\/ Get 5 least significant bits from the register TRISB and store}}
\DoxyCodeLine{\textcolor{comment}{//   result to the variable a}}
\DoxyCodeLine{a = \mbox{\hyperlink{tn__arch__pic24__bfa_8h_a8d4b939f57687bf93c982917100c064b}{TN\_BFAR}}(\mbox{\hyperlink{tn__arch__pic24__bfa_8h_ac2d2bd0a156045085b452360be0d621b}{TN\_BFA\_RD}}, TRISB, 0, 4);}
\end{DoxyCode}
 

Definition at line 268 of file tn\+\_\+arch\+\_\+pic32\+\_\+bfa.\+h.

